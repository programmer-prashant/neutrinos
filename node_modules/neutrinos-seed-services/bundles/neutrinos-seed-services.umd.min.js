!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/core"),require("@angular/common"),require("@angular/router"),require("rxjs/operators"),require("@angular/common/http"),require("platform"),require("ngforage"),require("rxjs"),require("firebase")):"function"==typeof define&&define.amd?define("neutrinos-seed-services",["exports","@angular/core","@angular/common","@angular/router","rxjs/operators","@angular/common/http","platform","ngforage","rxjs","firebase"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["neutrinos-seed-services"]={},e.ng.core,e.ng.common,e.ng.router,e.rxjs.operators,e.ng.common.http,e.platform,e.ngforage,e.rxjs,e.firebase)}(this,(function(e,t,r,n,o,i,s,a,c,u){"use strict";function p(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var h=p(u),d=function(){function e(){this._deviceType=this.checkDevice()}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.prototype.checkDevice=function(){return!window.device||"browser"==window.device.platform&&"Browser"==window.device.platform?!window.device||"browser"!=window.device.platform&&"Browser"!=window.device.platform?"browser":"cordova_browser":"mobile"},Object.defineProperty(e.prototype,"deviceType",{get:function(){return this._deviceType},enumerable:!1,configurable:!0}),e.prototype.getVal=function(t){return e.envProperties||(e.envProperties=window.neutrinos.environments,this.properties=e.envProperties.properties),"properties"==t?e.envProperties?e.envProperties.properties:void 0:e.envProperties&&e.envProperties.properties?e.envProperties.properties[t]:void 0},e.prototype.isAndroid=function(){return!(!window.device||"Android"!=window.device.platform)},e.prototype.isIOS=function(){return!(!window.device||"iOS"!=window.device.platform)},e.prototype.getAndroidVersion=function(){return this.isAndroid()?window.device.version:""},e.prototype.getAuthUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/auth/"},e.prototype.getTenantUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/"},e.prototype.getAppUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/proxy/"+this.properties.appName+"/"},e.prototype.getProxyUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/proxy/"},e.prototype.getDataModelUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/datamodel/"+this.properties.appDataSource+"/"+this.properties.appName+"/"},e.prototype.getFileIOUrl=function(){return this.properties.baseUrl+this.properties.tenantName+"/fileio/"+this.properties.appDataSource+"/"+this.properties.appName+"/"},e.prototype.getPlatformDetails=function(e){var t={platform:s.os.family,platformVersion:s.os.version};return"browser"===e?Object.assign(t,{type:"browser",browser:s.name,browserVersion:s.version}):"mobile"===e||"cordova_browser"===e?Object.assign(t,{type:"mobile",model:window.device.model,manufacturer:window.device.manufacturer,isVirtual:window.device.isVirtual}):void 0},e}(),l=function(){function e(){e.sessionStorageCache=sessionStorage}return e.prototype.getSessionStorage=function(){return e.sessionStorageCache},e.prototype.setValue=function(t,r){e.sessionStorageCache[t]=r,sessionStorage.setItem(t,r)},e.prototype.getValue=function(t){if(!e.sessionStorageCache[t])return null;try{var r=e.sessionStorageCache[t];return JSON.parse(r)}catch(r){return e.sessionStorageCache[t]}},e.prototype.remove=function(t){e.sessionStorageCache.hasOwnProperty(t)&&(delete e.sessionStorageCache[t],sessionStorage.removeItem(t))},e.prototype.clearSessionStorage=function(){e.sessionStorageCache={},sessionStorage.clear()},e}();l.sessionStorageCache={},l.decorators=[{type:t.Injectable}],l.ctorParameters=function(){return[]};var f=function(){function e(){}return e.prototype.generateUUID=function(){return this.__s4()+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+"-"+this.__s4()+this.__s4()+this.__s4()},e.prototype.__s4=function(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)},e}(),g=function(){function e(e,t,r){this.ngfConfig=e,this.ngf=t,this.ngfCache=r,this.storageCache={}}return e.prototype.initStorage=function(){var e=this;return new Promise((function(t,r){window.cordova&&e.initNgForage(),e.ngf.iterate((function(t,r,n){e.storageCache[r]=t})).then((function(r){return e.checkDeviceId(),t("iteration is completed")})).catch((function(e){return r(e)}))}))},e.prototype.getStorage=function(){return this.storageCache},e.prototype.setValue=function(e,t){return window.cordova&&this.initNgForage(),this.storageCache[e]=t,this.ngf.setItem(e,t).then((function(e){return e}),(function(e){console.log(e)}))},e.prototype.getValue=function(e){if(!this.storageCache[e])return null;try{var t=this.storageCache[e];return JSON.parse(t)}catch(t){return this.storageCache[e]}},e.prototype.remove=function(e){var t=this;delete this.storageCache[e],window.cordova&&this.initNgForage(),this.ngf.removeItem(e).then((function(r){delete t.ngf[e]})).catch((function(t){console.error("Could not remove",e)}))},e.prototype.clear=function(){this.storageCache={},this.ngf.clear()},e.prototype.pluginCheck=function(){window.cordova&&window.NativeStorage&&(this.nativeStorageI=window.NativeStorage)},e.prototype.getItemNs=function(e){var t=this;return new Promise((function(r,n){window.cordova&&window.NativeStorage&&t.nativeStorageI.getItem(e,(function(e){r(e)}),(function(e){n(e)}))}))},e.prototype.setItemNs=function(e,t){var r=this;return new Promise((function(n,o){window.cordova&&window.NativeStorage&&r.nativeStorageI.setItem(e,t,(function(e){n(e)}),(function(e){o(e)}))}))},e.prototype.removeItemNs=function(e){var t=this;return new Promise((function(r,n){window.cordova&&window.NativeStorage&&t.nativeStorageI.remove(e,(function(e){r(e)}),(function(e){n(e)}))}))},e.prototype.clearNs=function(){var e=this;return new Promise((function(t,r){window.cordova&&window.NativeStorage&&e.nativeStorageI.clear((function(e){t(e)}),(function(e){r(e)}))}))},e.prototype.initNgForage=function(){var e=window.neutrinos.environments.properties.NGFORAGE_MOBILE_DRIVER?window.neutrinos.environments.properties.NGFORAGE_MOBILE_DRIVER:"INDEXED_DB";this.ngfConfig.configure({name:"MyApp",driver:[a.Driver[e]]})},e.prototype.promiseReflect=function(e){return e.then((function(e){return{v:e,status:"resolved"}}),(function(e){return{e:e,status:"rejected"}}))},e.prototype.clearLocalStorage=function(){this.remove("userObj"),this.remove("accessToken"),this.remove("refreshToken"),this.remove("registrationId")},e.prototype.checkDeviceId=function(){var e=this;return"browser"===d.getInstance().checkDevice()?(this._deviceUUID=this.getValue("uuid"),this._deviceUUID||(this._deviceUUID=(new f).generateUUID(),this.setValue("uuid",this._deviceUUID))):window.plugins.uniqueDeviceID.get((function(t){e._deviceUUID=t,e.setValue("uuid",e._deviceUUID)})),this._deviceUUID},Object.defineProperty(e.prototype,"deviceUUID",{get:function(){return this._deviceUUID},enumerable:!1,configurable:!0}),e}();g.decorators=[{type:t.Injectable}],g.ctorParameters=function(){return[{type:a.NgForageConfig},{type:a.NgForage},{type:a.NgForageCache}]};var v=function(){function e(e){this.nLocalStorageService=e,this.nSessionStorage=new l}return e.prototype.updateTokens=function(e,t){var r=this.decodeToken(e.accessToken);this.nSessionStorage.setValue("accessToken",e.accessToken),this.nSessionStorage.setValue("refreshToken",e.refreshToken),this.nSessionStorage.setValue("userObj",JSON.stringify(r)),(t||this.nLocalStorageService.getValue("accessToken"))&&(this.nLocalStorageService.setValue("accessToken",e.accessToken),this.nLocalStorageService.setValue("refreshToken",e.refreshToken),this.nLocalStorageService.setValue("userObj",JSON.stringify(r)))},e.prototype.updateSessionStorage=function(){this.updateTokens(this.nLocalStorageService.getStorage(),!0)},e.prototype.urlBase64Decode=function(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}return this.b64DecodeUnicode(t)},e.prototype.b64decode=function(e){var t="";if((e=String(e).replace(/=+$/,"")).length%4==1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(var r=0,n=void 0,o=void 0,i=0;o=e.charAt(i++);~o&&(n=r%4?64*n+o:o,r++%4)?t+=String.fromCharCode(255&n>>(-2*r&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return t},e.prototype.b64DecodeUnicode=function(e){return decodeURIComponent(Array.prototype.map.call(this.b64decode(e),(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)})).join(""))},e.prototype.decodeToken=function(e){var t=e.split(".");if(3!==t.length)throw new Error("JWT must have 3 parts");var r=this.urlBase64Decode(t[1]);if(!r)throw new Error("Cannot decode the token");return JSON.parse(r)},e.prototype.getTokenExpirationDate=function(e){var t;if(!(t=this.decodeToken(e)).hasOwnProperty("exp"))return null;var r=new Date(0);return r.setUTCSeconds(t.exp),r},e.prototype.isTokenExpired=function(e,t){var r=this.getTokenExpirationDate(e);return t=t||0,null!=r&&!(r.valueOf()>(new Date).valueOf()+1e3*t)},e}();v.decorators=[{type:t.Injectable}],v.ctorParameters=function(){return[{type:g}]};var S=function(){function e(){this.events={}}return e.prototype.$sub=function(e,t,r,n){if(!e)throw new Error("[PubSub Service] => Subscription method must get event name.");return void 0===this.events[e]&&(this.events[e]=new c.Subject),"function"!=typeof t?this.events[e].asObservable():this.events[e].asObservable().subscribe(t,r,n)},e.prototype.$pub=function(e,t){if(!e)throw new Error("[PubSub Service] => Publish method must get event name.");this.events[e]&&this.events[e].next(t)},e}();S.decorators=[{type:t.Injectable}],S.ctorParameters=function(){return[]};var y=function(){function e(e){this.nLocalStorageService=e,this.nSessionStorage=new l}return e.prototype.logout=function(){return this.nSessionStorage.clearSessionStorage(),this.nLocalStorageService.clearLocalStorage(),!0},e}();y.decorators=[{type:t.Injectable}],y.ctorParameters=function(){return[{type:g}]};var m=function(){function e(e,t){this.nLogoutService=e,this.nPubSubService=t,this.pendingRequests=0,this.showLoading=!1,this._isHTTPRequestInProgress=new c.Subject,this._isHTTPRequestInProgress$=this._isHTTPRequestInProgress.asObservable()}return e.prototype.isHTTPRequestInProgress=function(e){e?(this.pendingRequests++,this.showLoading||this._isHTTPRequestInProgress.next(e),this.showLoading=!0):(this.pendingRequests--,this.pendingRequests<=0&&(this.showLoading&&this._isHTTPRequestInProgress.next(e),this.showLoading=!1))},e.prototype.alertError=function(e){e.status<200||e.status>500?0===e.status?this.nPubSubService.$pub("openSnackBar","Connectivity issue"):this.nPubSubService.$pub("openSnackBar","Response failure"):401===e.status?(this.nLogoutService.logout(),e.error?this.nPubSubService.$pub("openSnackBar",e.error):this.nPubSubService.$pub("openSnackBar",e)):e.error?e.error instanceof Object?this.nPubSubService.$pub("openSnackBar",e.error.message):this.nPubSubService.$pub("openSnackBar",e.error):this.nPubSubService.$pub("openSnackBar","Response failure")},e}();m.decorators=[{type:t.Injectable}],m.ctorParameters=function(){return[{type:y},{type:S}]};var b=function(){function e(e,t,r,n){var o=this;this.localStorageService=e,this.pubSubService=t,this.http=r,this.bHttpLoader=n,this.systemService=d.getInstance(),this.possiblePushTypes=["APNS","FCM"],this.firebaseSenderId=this.systemService.getVal("firebaseSenderId"),this.isNotificationEnabled=this.systemService.getVal("isNotificationEnabled"),this.appName=this.systemService.getVal("appName"),this.deviceType=this.systemService.deviceType,this.sessionStorage=new l,this.loginSubscribe=this.pubSubService.$sub("firebaseRegister",(function(){o.enableNotification()}))}return e.prototype.ngOnInit=function(){},e.prototype.enableNotification=function(){var e=this,t=this.getPushType(this.systemService.getVal("pushType"));document.addEventListener("deviceready",(function(r){e.isNotificationEnabled&&e.deviceType&&"browser"!=e.deviceType&&(e.deviceType=e.systemService.deviceType,e.checkPermission(t).then((function(r){r&&e.initializeNotifications(t)})))})),this.isNotificationEnabled&&"APNS"!==t&&this.deviceType&&"browser"==this.deviceType&&window.Notification&&this.initialiseWebPush()},e.prototype.initialiseWebPush=function(){var e=this,t=h.default.messaging();Notification.requestPermission().then((function(){return t.getToken()})).then((function(t){t&&e.sendRegDetails(t)})).catch((function(t){e.bHttpLoader.alertError(t)})),t.onMessage((function(e){if(e.notification){var t=e.notification,r={body:t.body,icon:t.icon};new Notification(t.title,r).onclick=function(){window.focus()}}}))},e.prototype.checkPermission=function(e){var t=this;return new Promise((function(r){if(e=t.getPushType(e),"Android"!==t.deviceType&&"iOS"!==t.deviceType||"FCM"!==e){if("iOS"!==t.deviceType||"APNS"!==e)return r(!0);APNSPushNotification.hasPermission((function(e){return r(e.isEnabled)}))}else PushNotification.hasPermission((function(e){return r(e.isEnabled)}))}))},e.prototype.initializeNotifications=function(e){var t,r=this;"FCM"===(e=this.getPushType(e))?t=window.PushNotification.init({android:{senderID:this.firebaseSenderId},ios:{alert:"true",badge:"true",sound:"true",senderID:this.firebaseSenderId}}):"APNS"===e&&(t=window.APNSPushNotification.init({ios:{alert:"true",badge:"true",sound:"true"}})),t.on("registration",(function(e){r.sendRegDetails(e.registrationId)})),t.on("notification",(function(e){window.cordova.plugins.notification.local.schedule({title:e.title,text:e.message,sound:e.sound,at:(new Date).getTime()})})),t.on("error",(function(e){console.error(e)}))},e.prototype.sendRegDetails=function(e){this.localStorageService.setValue("registrationId",e);var t=this.systemService.getTenantUrl()+"notification/"+this.systemService.getVal("appName")+"/register",r=this.getPushType(this.systemService.getVal("pushType"));this.http.post(t,{key:this.sessionStorage.getValue("userObj").userKey,uuid:this.localStorageService.getValue("uuid"),fbregid:e,pushType:r}).subscribe((function(e){}),(function(e){console.log(e)}))},e.prototype.getPushType=function(e){return void 0!==e&&this.possiblePushTypes.includes(e.toUpperCase())?e.toUpperCase():"FCM"},e.prototype.ngOnDestroy=function(){this.loginSubscribe.unSubscribe()},e}();b.decorators=[{type:t.Injectable}],b.ctorParameters=function(){return[{type:g},{type:S},{type:i.HttpClient},{type:m}]};var w=function(){function e(e,r,n,o,i){this.http=e,this.pubSubService=r,this.notificationService=n,this.nLocalStorageService=o,this.nTokenService=i,this.loginCompleted=new t.EventEmitter,this.systemService=d.getInstance(),this.nSessionStorage=new l}return e.prototype.login=function(e,t,r){var n=this;return this.appProperties=this.systemService.getVal("properties"),this.loginUrl=this.systemService.getAuthUrl()+this.appProperties.appName,this.uuid=this.nLocalStorageService.getValue("uuid"),this.uuid||(this.uuid=this.nLocalStorageService.checkDeviceId()),this.details={username:e,password:t},this.details.platformDetails=this.systemService.getPlatformDetails(this.systemService.checkDevice()),this.details.platformDetails.uuid=this.uuid,this.http.post(this.loginUrl,JSON.stringify(this.details)).pipe(o.map((function(e){var t=e;return t&&n.nTokenService.updateTokens(t,r),("FIREBASE_SENDER_ID"!=n.systemService.getVal("firebaseSenderId")&&"FIREBASE_AUTH_KEY"!=n.systemService.getVal("firebaseAuthKey")||"APNS"===n.systemService.getVal("pushType")&&n.systemService.isIOS())&&n.pubSubService.$pub("firebaseRegister"),n.pubSubService.$pub("loginComplete"),e}),(function(e){return e})))},e.prototype.isLoggedIn=function(){var e=this;return this.nLocalStorageService.initStorage().then((function(t){return!(!e.nSessionStorage.getValue("accessToken")||!e.nSessionStorage.getValue("refreshToken")||"null"==e.nSessionStorage.getValue("accessToken")||"null"==e.nSessionStorage.getValue("refreshToken"))})).catch((function(e){return!1}))},e}();w.decorators=[{type:t.Injectable}],w.ctorParameters=function(){return[{type:i.HttpClient},{type:S},{type:b},{type:g},{type:v}]},w.propDecorators={loginCompleted:[{type:t.Output}]};var k=function(){function e(e,t){this.nLoginService=e,this.router=t}return e.prototype.canActivate=function(){var e=this;return this.nLoginService.isLoggedIn().then((function(t){return!!t||(e.router.navigate(["unauthorized"]),!1)}))},e}();k.decorators=[{type:t.Injectable}],k.ctorParameters=function(){return[{type:w},{type:n.Router}]};var I=function(){function e(e){this.http=e,this.invalidDataModelName="Invalid data model name.",this.invalidDataModelId="Invalid data model id.",this.invalidDataModelObj="Invalid data model object.",this.systemService=d.getInstance()}return e.prototype.get=function(e,t,r,n,i,s){if(e){var a=this.getDataSourceURL(e)+e;if(this.checkIfValid(t)||this.checkIfValid(r)||this.checkIfValid(n)||this.checkIfValid(i)||this.checkIfValid(s)){var u=""+this.toQueryString({filter:t,keys:r,sort:n,pagenumber:i,pagesize:s});""===u?u+="?filter={}":u="?".concat(u),a+=u}return this.http.get(a).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}return c.throwError(new Error("Could not get "+e+". "+this.invalidDataModelName))},e.prototype.put=function(e,t){if(e){if(t){var r=this.getDataSourceURL(e)+e;return this.http.put(r,t).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}return c.throwError(new Error("Could not put "+t+" in "+e+". "+this.invalidDataModelObj))}return c.throwError(new Error("Could not put "+t+" in "+e+". "+this.invalidDataModelName))},e.prototype.delete=function(e,t){var r;return e?(r=this.getDataSourceURL(e)+e,this.checkIfValid(t)&&""!=t?r+="?filter="+t:r+="?filter={}",this.http.delete(r).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))):c.throwError(new Error("Could not delete "+e+". "+this.invalidDataModelName))},e.prototype.update=function(e,t){if(e&&t){var r=this.getDataSourceURL(e)+e;return this.http.patch(r,t).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}return c.throwError(new Error("Could not update "+e+". "+this.invalidDataModelName))},e.prototype.getById=function(e,t){if(e){if(t){var r=this.getDataSourceURL(e)+e+"/"+t;return this.http.get(r).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}c.throwError(new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))}else c.throwError(new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelName))},e.prototype.deleteById=function(e,t){if(!e)return c.throwError(new Error("Could not delete "+e+" by id "+t+". "+this.invalidDataModelName));if(t){var r=this.getDataSourceURL(e)+e+"/"+t;return this.http.delete(r).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}c.throwError(new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))},e.prototype.updateById=function(e,t,r){if(!e)return c.throwError(new Error("Could not delete "+e+" by id "+t+". "+this.invalidDataModelName));if(t){var n=this.getDataSourceURL(e)+e+"/"+t,i=Object.assign({},r);return delete i._id,this.http.patch(n,i).pipe(o.map((function(e,t){return e})),o.catchError((function(e){return c.throwError(e)})))}c.throwError(new Error("Could not get "+e+" by id "+t+". "+this.invalidDataModelId))},e.prototype.toQueryString=function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&this.checkIfValid(e[r])&&t.push(r+"="+JSON.stringify(e[r]));return t.join("&")},e.prototype.checkIfValid=function(e){return void 0!==e&&null!=e},e.prototype.getDataSourceURL=function(e){this.dmDs||(this.dmDs=window.neutrinos.dataSource);var t=this.dmDs[e],r=this.systemService.properties;return t?r.baseUrl+r.tenantName+"/datamodel/"+t+"/"+r.appName+"/":this.systemService.getDataModelUrl()},e}();I.decorators=[{type:t.Injectable}],I.ctorParameters=function(){return[{type:i.HttpClient}]};var P=function(){function e(e,t,r,n){this.nHTTPLoader=e,this.inj=t,this.nLocalStorageService=r,this.nTokenService=n,this.timeout=9e4,this.isRefreshingToken=!1,this.tokenSubject=new c.BehaviorSubject(null),this.systemService=d.getInstance(),this.nSessionStorage=new l,this.appProperties=this.systemService.getVal("properties"),this.nPubSubService=new S}return e.prototype.intercept=function(e,t){var r=this;return this.requestInterceptor(),t.handle(this.requestOptions(e)).pipe(o.timeout(this.timeout),o.catchError((function(n){return r.onCatch(n,e,t)})),o.finalize((function(){r.onFinally()})))},e.prototype.updateToken=function(e,t,r){var n=this;return"activeDirectory"===this.appProperties.appAuthenticationStrategy||"localAuth"===this.appProperties.appAuthenticationStrategy?this.isRefreshingToken?this.tokenSubject.pipe(o.filter((function(e){return null!=e})),o.take(1),o.switchMap((function(e){return r.handle(n.requestOptions(t))}))):(this.isRefreshingToken=!0,this.tokenSubject.next(null),this.refreshToken().pipe(o.switchMap((function(e){if(e){n.nTokenService.updateTokens(e);var o=e.accessToken;return n.tokenSubject.next(o),r.handle(n.requestOptions(t))}return c.throwError(new Error("Can't refresh the token"))})),o.catchError((function(e){return n.onCatchError(e)})),o.finalize((function(){return n.isRefreshingToken=!1})))):this.onCatchError(e)},e.prototype.refreshToken=function(){var e=this.inj.get(i.HttpClient),t=this.systemService.getVal("properties"),r=this.systemService.getAuthUrl()+t.appName+"/refresh",n={platformDetails:this.systemService.getPlatformDetails(this.systemService.checkDevice()),userKey:this.nSessionStorage.getValue("userObj").userKey,refreshToken:this.nSessionStorage.getValue("refreshToken")};return n.platformDetails.uuid=this.nLocalStorageService.getValue("uuid"),e.post(r,n)},e.prototype.requestOptions=function(e){var t=e.headers;null==e.headers&&(t=new i.HttpHeaders),e=e.clone({url:this.getFullUrl(e.url),headers:t});var r=d.getInstance().getVal("baseUrl");return""!==r&&e.url.includes(r)?this.addDefaultHeaders(e):e},e.prototype.addDefaultHeaders=function(e){if(e.headers.has("Access-Control-Allow-Origin")||(e.headers=e.headers.set("Access-Control-Allow-Origin","*")),e.headers.has("Content-Type")?e.headers.has("Content-Type")&&"no-content"===e.headers.get("Content-Type")&&(e.headers=e.headers.delete("Content-Type")):e.headers=e.headers.set("Content-Type","application/json"),e.headers.has("Accept")||(e.headers=e.headers.set("Accept","application/json")),!e.headers.has("Authorization"))if(this.appProperties=this.systemService.getVal("properties"),this.appProperties&&"basicAuth"===this.appProperties.appAuthenticationStrategy){var t=void 0,r=void 0;this.appProperties.basicAuthUser&&this.appProperties.basicAuthPassword?(t=this.appProperties.basicAuthUser,r=this.appProperties.basicAuthPassword):(t="bhive-art-proxyuser",r="password",console.warn("Authentication strategy: Basic Auth. basicAuthUser and basicAuthPassword are not configured in environment. Setting default values.")),e.headers=e.headers.set("Authorization","Basic "+btoa(t+":"+r))}else!this.appProperties||"activeDirectory"!==this.appProperties.appAuthenticationStrategy&&"localAuth"!==this.appProperties.appAuthenticationStrategy||this.nSessionStorage.getValue("accessToken")&&(e.headers=e.headers.set("Authorization","Bearer "+this.nSessionStorage.getValue("accessToken")));return e},e.prototype.getFullUrl=function(e){return e},e.prototype.requestInterceptor=function(){this.nHTTPLoader.isHTTPRequestInProgress(!0)},e.prototype.responseInterceptor=function(){this.nHTTPLoader.isHTTPRequestInProgress(!1)},e.prototype.onCatch=function(e,t,r){return e instanceof i.HttpErrorResponse&&403===e.status&&"jwt expired"===e.error.message?this.updateToken(e,t,r):this.onSubscribeError(e)},e.prototype.onSubscribeError=function(e){return this.nHTTPLoader.alertError(e),this.onCatchError(e)},e.prototype.onFinally=function(){this.responseInterceptor()},e.prototype.onCatchError=function(e){return c.throwError(e)},e}();P.decorators=[{type:t.Injectable}],P.ctorParameters=function(){return[{type:m},{type:t.Injector},{type:g},{type:v}]};var T=function(){function e(e){var t=this;this.nPubSubService=e,this.snackService=new c.Subject,d.getInstance().getVal("useDefaultExceptionUI")&&(this.snackBarListner=this.nPubSubService.$sub("openSnackBar",(function(e){t.openSnackBar(e)})))}return e.prototype.get=function(){return this.snackService.asObservable()},e.prototype.add=function(e){this.snackService.next({action:"add",data:e})},e.prototype.remove=function(e){this.snackService.next({action:"remove",id:e})},e.prototype.clear=function(){this.snackService.next({action:"clear"})},e.prototype.openSnackBar=function(e,t){this.add({msg:e,timeout:t||5e3,action:{text:"Close",onClick:function(e){}},onAdd:function(e){},onRemove:function(e){}})},e}();T.decorators=[{type:t.Injectable}],T.ctorParameters=function(){return[{type:S}]};var C=function(){};C.decorators=[{type:t.Component,args:[{selector:"n-snack",template:"\n     <div class=\"snack\" [ngStyle]=\"{background: background ? background : '#323232' , color: color ? color : '#fff'}\" [ngClass]=\" ['snackbar-layout', 'customClass' ]\">\n          <ng-content></ng-content>\n       </div> \n  ",styles:[".snack-action{color:#2196f3;cursor:pointer;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{flex:1 0;margin-right:.5em;width:60%}.snackbars.bottom-center{align-items:middle}.snackbars{display:flex;display:inline;font-family:Roboto;letter-spacing:1px;max-width:100%;position:fixed;word-wrap:break-word;z-index:99999}.snackbars.bottom-center{align-items:center;bottom:1px;left:50%;transform:translate(-50%)}.snack{border-radius:.3em;max-height:50vh;overflow:auto;padding:1em}"]}]}],C.propDecorators={background:[{type:t.Input}],color:[{type:t.Input}],customClass:[{type:t.Input}]};var x=function(){function e(e){var r=this;this.snackbarService=e,this.max=1,this.onAdd=new t.EventEmitter,this.onRemove=new t.EventEmitter,this.onClear=new t.EventEmitter,this.snacks=[],this.snackbarService.get().subscribe((function(e){"add"===e.action?r.add(e.data):"remove"===e.action?r.remove(e.id):"clear"===e.action&&r.clear()}))}return e.prototype.add=function(e){var t,r=this,n=this.uuid();this.max&&this.max>0&&this.snacks.length===this.max&&this.remove(this.snacks[0].id),(e.timeout||this.timeout)&&(t=setTimeout((function(){r.remove(n)}),e.timeout||this.timeout));var o=Object.assign({id:n,timeoutObj:t},e);if(e.action){var i=this,s=e.action.onClick||new Function;e.action.onClick=function(){s(o),i.remove(n)}}e.onAdd&&e.onAdd(o),this.onAdd&&this.onAdd.emit(o),this.snacks.push(o)},e.prototype.remove=function(e){var t=this.snacks.find((function(t){return t.id===e}));t&&(t.onRemove&&t.onRemove(t),this.onRemove&&this.onRemove.emit(t),t.timeoutObj&&clearTimeout(t.timeoutObj)),this.snacks=this.snacks.filter((function(t){return t.id!==e}))},e.prototype.clear=function(){this.snacks=[],this.onClear&&this.onClear.emit(!0)},e.prototype.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e.prototype.calcTextColor=function(e){if(!e)return null;var t=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,(function(e,t,r,n){return t+t+r+r+n+n}));var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}(e);if(!t)return null;for(var r=[t.r/255,t.g/255,t.b/255],n=0;n<r.length;++n)r[n]<=.03928?r[n]=r[n]/12.92:r[n]=Math.pow((r[n]+.055)/1.055,2.4);return.2126*r[0]+.7152*r[1]+.0722*r[2]>.179?"#000":"#fff"},e}();function N(e){return function(){return e.initStorage()}}function E(e){return new a.NgForage({},new a.InstanceFactory(e))}x.decorators=[{type:t.Component,args:[{selector:"n-snackbar",template:'\n      <div class="snackbars" [ngClass]="position || \'bottom-center\'">\n          <n-snack   *ngFor="let snackbar of snacks" [background]="snackbar.background || background"\n                        [customClass]="snackbar.customClass || customClass"\n                        [color]="snackbar.color || color || calcTextColor(snackbar.background || background)">\n              <div class="container">\n              <div class="snack-text child" >\n                  {{snackbar.msg}}\n              </div>\n              <div *ngIf="snackbar.action.text" class="snack-action" (click)="snackbar.action.onClick()"\n                   [ngStyle]="{color: snackbar.action.color || accent}">\n                  {{snackbar.action.text}}\n              </div>\n              </div>\n          </n-snack>\n      </div>\n  ',styles:[".snack-action{color:#2196f3;cursor:pointer;font-weight:700}.container{display:flex;flex-direction:row;flex-wrap:wrap}.child{flex:1 0;margin-right:.5em;width:60%}.snackbars.bottom-center{align-items:middle}.snackbars{display:flex;display:inline;font-family:Roboto;letter-spacing:1px;max-width:100%;position:fixed;word-wrap:break-word;z-index:99999}.snackbars.bottom-center{align-items:center;bottom:1px;left:50%;transform:translate(-50%)}.snack{border-radius:.3em;max-height:50vh;overflow:auto;padding:1em}"]}]}],x.ctorParameters=function(){return[{type:T}]},x.propDecorators={position:[{type:t.Input}],max:[{type:t.Input}],background:[{type:t.Input}],accent:[{type:t.Input}],color:[{type:t.Input}],customClass:[{type:t.Input}],timeout:[{type:t.Input}],onAdd:[{type:t.Output}],onRemove:[{type:t.Output}],onClear:[{type:t.Output}]};var D=function(){};D.decorators=[{type:t.NgModule,args:[{imports:[r.CommonModule,i.HttpClientModule,n.RouterModule],providers:[{provide:i.HTTP_INTERCEPTORS,useClass:P,multi:!0},{provide:t.APP_INITIALIZER,useFactory:N,deps:[g],multi:!0},{provide:a.NgForage,useFactory:E,deps:[a.NgForageConfig]},k,I,P,m,g,w,y,b,T,S,l,v],declarations:[C,x],exports:[C,x]}]}],e.NAuthGuardService=k,e.NDataModelService=I,e.NHTTPLoaderService=m,e.NHttpService=P,e.NLocalStorageService=g,e.NLoginService=w,e.NLogoutService=y,e.NNotificationService=b,e.NPubSubService=S,e.NSessionStorageService=l,e.NSnackbarService=T,e.NSystemService=d,e.NTokenService=v,e.NUtility=f,e.NeutrinosSeedServicesModule=D,e.NgForageFactory=E,e.SnackComponent=C,e.SnackbarComponent=x,e.startupServiceFactory=N,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=neutrinos-seed-services.umd.min.js.map