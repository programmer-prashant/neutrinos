import { __decorate } from "tslib";
/*DEFAULT GENERATED TEMPLATE. DO NOT CHANGE SELECTOR TEMPLATE_URL AND CLASS NAME*/
import { Component, ViewChild, Input, Output, EventEmitter } from '@angular/core';
import * as signing from 'signature_pad';
// import { MatSnackBar } from '@angular/material';
/**
* Model import Example :
* import { HERO } from '../models/hero.model';
*/
/**
 * Service import Example :
 * import { HeroService } from '../services/hero/hero.service';
 */
let NSignatureComponent = class NSignatureComponent {
    constructor() {
        this.imageDataValue = '';
        this.signaturePad = '';
        this.mode = 'responsive'; // 'click-fullscreen' or 'responsive'
        this.canvasMode = 'responsive'; // 'responsive' or 'fullscreen'
        this.imageDataChange = new EventEmitter();
    }
    get imageData() {
        return this.imageDataValue;
    }
    set imageData(val) {
        this.imageDataValue = val;
        if (val || val === '' || this.isDataURL(val)) {
            this.saveCavas(val);
        }
        this.imageDataChange.emit(this.imageDataValue);
    }
    ngAfterViewInit() {
        if (this.mode === 'responsive') {
            this.createCanvas();
        }
    }
    createCanvas() {
        this.fitToContainer(this.signaturecanvas.nativeElement);
        this.signaturePad = new signing.default(this.signaturecanvas.nativeElement, this.assignOptions());
    }
    saveCavas(dataUrl) {
        if (this.signaturePad) {
            if (this.signaturePad.isEmpty() || dataUrl === '') {
                this.savedData = '';
                this.signaturePad.clear();
            }
            else if (this.isDataURL(dataUrl)) {
                this.signaturePad.fromDataURL(dataUrl);
                this.savedData = this.signaturePad.toData();
            }
            else {
                this.imageData = this.signaturePad.toDataURL();
                if (this.mode === 'click-fullscreen') {
                    this.savedData = this.signaturePad.toData();
                    this.hideCanvas();
                }
            }
        }
    }
    clearCanvas() {
        this.signaturePad.clear();
        // this.fitToContainer(this.signaturecanvas.nativeElement);
    }
    undoCanvas() {
        const data = this.signaturePad.toData();
        if (data) {
            data.pop(); // remove the last dot or line
            this.signaturePad.fromData(data);
        }
    }
    showCanvas() {
        this.classAbs = true;
        this.canvasMode = 'fullscreen';
        if (!this.signaturePad) {
            this.createCanvas();
        }
        this.fitToContainer(this.signaturecanvas.nativeElement, document.body.clientHeight, document.body.clientWidth);
        this.clearCanvas();
        this.createCanvasFromData();
    }
    hideCanvas() {
        this.canvasMode = 'responsive';
    }
    // cancel currently drawn
    cancel() {
        this.savedData = Object.assign([], this.previousSavedData);
    }
    createCanvasFromData() {
        if (this.savedData) {
            this.previousSavedData = Object.assign({}, this.savedData);
            this.signaturePad.fromData(this.savedData);
        }
    }
    fitToContainer(element, height, width) {
        element.style.width = '100%';
        element.style.height = 'calc(100% - 56px)';
        if (height && width) {
            element.width = width;
            element.height = height - 56;
        }
        else {
            element.width = element.offsetWidth;
            element.height = element.offsetHeight;
        }
    }
    assignOptions() {
        let options = {};
        options['backgroundColor'] = this.checkIfValidValueAndRGB(this.backgroundColor, 'backgroundColor');
        options['dotSize'] = this.checkIfValidValueAndNumber(this.dotSize, 'dotSize');
        options['minWidth'] = this.checkIfValidValueAndNumber(this.minWidth, 'minWidth');
        options['maxWidth'] = this.checkIfValidValueAndNumber(this.maxWidth, 'maxWidth');
        options['throttle'] = this.checkIfValidValueAndNumber(this.throttle, 'throttle');
        options['minDistance'] = this.checkIfValidValueAndNumber(this.minDistance, 'minDistance');
        options['penColor'] = this.checkIfValidValueAndRGB(this.penColor, 'penColor');
        options['velocityFilterWeight'] = this.checkIfValidValueAndNumber(this.velocityFilterWeight, 'velocityFilterWeight');
        options = JSON.parse(JSON.stringify(options)); // removing all undefined fields
        options['onBegin'] = this.checkIfValidValueAndFunction(this.onBegin, 'onBegin');
        options['onEnd'] = this.checkIfValidValueAndFunction(this.onEnd, 'onEnd');
        return options;
    }
    checkIfValidValueAndNumber(num, name) {
        if (this.checkIfValid(num) && this.checkNumber(num)) {
            return num;
        }
        this.invalidToast(name, 'num');
        return undefined;
    }
    checkIfValidValueAndRGB(color, name) {
        if (this.checkIfValid(color) && this.checkRGB(color)) {
            return color;
        }
        this.invalidToast(name, 'rgb');
        return undefined;
    }
    checkIfValidValueAndFunction(fn, name) {
        if (this.checkIfValid(fn) && this.checkIfValidFunction(fn)) {
            return fn;
        }
        this.invalidToast(name, 'function format');
        return undefined;
    }
    checkIfValid(value) {
        return (value !== undefined && value !== null) ? value : undefined;
    }
    checkNumber(num) {
        return !this.checkIsNan(Number(num)) ? Number(num) : undefined;
    }
    checkIfValidFunction(fn) {
        return typeof fn === 'function' ? fn : undefined;
    }
    checkRGB(color) {
        const matchColors1 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),(\d{1,3})\)/);
        const matchColors2 = new RegExp(/rgb\((\d{1,3}),[ \t]+(\d{1,3}),(\d{1,3})\)/);
        const matchColors3 = new RegExp(/rgb\((\d{1,3}),(\d{1,3}),[ \t]+(\d{1,3})\)/);
        return matchColors1.test(color) || matchColors2.test(color) || matchColors3.test(color);
    }
    checkIsNan(value) {
        return Number.isNaN(value);
    }
    invalidToast(optionName, optionType) {
        switch (optionType) {
            case 'num':
                // this.snackbar.open(`Invalid ${optionName} (number or float) given, taking default value instead.`, 'OK');
                break;
            case 'rgb':
                // this.snackbar.open(`Invalid ${optionName} format Eg: rgb(255, 255, 255)  given, taking default value instead.`, 'OK');
                break;
        }
        return;
    }
    isDataURL(s) {
        if (s) {
            const regex = /^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;
            return !!s.match(regex);
        }
        else {
            return false;
        }
    }
};
__decorate([
    ViewChild('signaturecanvas', { static: false })
], NSignatureComponent.prototype, "signaturecanvas", void 0);
__decorate([
    ViewChild('canvasparent', { static: false })
], NSignatureComponent.prototype, "canvasparent", void 0);
__decorate([
    Input('backgroundColor')
], NSignatureComponent.prototype, "backgroundColor", void 0);
__decorate([
    Input('dotSize')
], NSignatureComponent.prototype, "dotSize", void 0);
__decorate([
    Input('minWidth')
], NSignatureComponent.prototype, "minWidth", void 0);
__decorate([
    Input('maxWidth')
], NSignatureComponent.prototype, "maxWidth", void 0);
__decorate([
    Input('throttle')
], NSignatureComponent.prototype, "throttle", void 0);
__decorate([
    Input('minDistance')
], NSignatureComponent.prototype, "minDistance", void 0);
__decorate([
    Input('penColor')
], NSignatureComponent.prototype, "penColor", void 0);
__decorate([
    Input('velocityFilterWeight')
], NSignatureComponent.prototype, "velocityFilterWeight", void 0);
__decorate([
    Input('onBegin')
], NSignatureComponent.prototype, "onBegin", void 0);
__decorate([
    Input('onEnd')
], NSignatureComponent.prototype, "onEnd", void 0);
__decorate([
    Input('mode')
], NSignatureComponent.prototype, "mode", void 0);
__decorate([
    Output()
], NSignatureComponent.prototype, "imageDataChange", void 0);
__decorate([
    Input()
], NSignatureComponent.prototype, "imageData", null);
NSignatureComponent = __decorate([
    Component({
        selector: 'n-signature',
        template: "<div fxFill fxLayout=\"row\" *ngIf=\"mode == 'click-fullscreen' && canvasMode !== 'fullscreen'\" class=\"signature-component-border\">\n    <div fxFlex=\"calc(100%-56px)\" fxLayout=\"column\">\n        <img *ngIf=\"imageDataValue\" [src]=\"imageDataValue\" fxFill/>\n    </div>\n    <div fxFlex=\"56px\" fxLayoutAlign=\" center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"showCanvas()\">\n            <mat-icon>mode_edit</mat-icon>\n        </button>\n    </div>\n</div>\n<div fxFill fxLayout=\"column\" class=\"signature-component-border\" [fxShow]=\"(mode == 'click-fullscreen' && canvasMode == 'fullscreen') || mode == 'responsive'\" [ngClass]=\"{'signature-canvas-fullscreen': classAbs}\">\n    <canvas #signaturecanvas></canvas>\n    <div fxFlex=\"56px\" fxLayoutAlign=\"center center\" class=\"signature-component-border\">\n        <button mat-icon-button (click)=\"undoCanvas()\">\n            <mat-icon>undo</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"clearCanvas()\">\n            <mat-icon>loop</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"saveCavas()\">\n            <mat-icon>save</mat-icon>\n        </button>\n        <button mat-icon-button (click)=\"canvasMode = 'responsive'; cancel()\">\n            <mat-icon>clear</mat-icon>\n        </button>\n    </div>\n</div>",
        styles: [`
     :host { height: 100% !important; }
     .signature-canvas-fullscreen {
         position: absolute;
         top: 0;
         bottom: 0;
         right: 0;
         left: 0;
     }
     .signature-component-border {
         border: 2px solid black;
     }
    `]
    })
], NSignatureComponent);
export { NSignatureComponent };
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibi1zaWduYXR1cmUuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmV1dHJpbm9zLW1vZHVsZS8iLCJzb3VyY2VzIjpbInNyYy9hcHAvbmV1dHJpbm9zLW1vZHVsZS9uZXV0cmlub3MtY29tcG9uZW50cy9uU2lnbmF0dXJlQ29tcG9uZW50L24tc2lnbmF0dXJlLmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiO0FBQUEsa0ZBQWtGO0FBQ2xGLE9BQU8sRUFBRSxTQUFTLEVBQWlCLFNBQVMsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFlBQVksRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUNqRyxPQUFPLEtBQUssT0FBTyxNQUFNLGVBQWUsQ0FBQztBQUN6QyxtREFBbUQ7QUFDbkQ7OztFQUdFO0FBRUY7OztHQUdHO0FBb0JILElBQWEsbUJBQW1CLEdBQWhDLE1BQWEsbUJBQW1CO0lBQWhDO1FBRUksbUJBQWMsR0FBRyxFQUFFLENBQUM7UUFDWixpQkFBWSxHQUFRLEVBQUUsQ0FBQztRQWVoQixTQUFJLEdBQUcsWUFBWSxDQUFDLENBQUMscUNBQXFDO1FBQ3pFLGVBQVUsR0FBRyxZQUFZLENBQUMsQ0FBQywrQkFBK0I7UUFLaEQsb0JBQWUsR0FBRyxJQUFJLFlBQVksRUFBRSxDQUFDO0lBcUxuRCxDQUFDO0lBbkxHLElBQUksU0FBUztRQUNULE9BQU8sSUFBSSxDQUFDLGNBQWMsQ0FBQztJQUMvQixDQUFDO0lBRUQsSUFBSSxTQUFTLENBQUMsR0FBRztRQUNiLElBQUksQ0FBQyxjQUFjLEdBQUcsR0FBRyxDQUFDO1FBQzFCLElBQUksR0FBRyxJQUFJLEdBQUcsS0FBSyxFQUFFLElBQUksSUFBSSxDQUFDLFNBQVMsQ0FBQyxHQUFHLENBQUMsRUFBRTtZQUMxQyxJQUFJLENBQUMsU0FBUyxDQUFDLEdBQUcsQ0FBQyxDQUFDO1NBQ3ZCO1FBQ0QsSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLGNBQWMsQ0FBQyxDQUFD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QUFLLENBQUMsVUFBVSxDQUFDO3FEQUFVO0FBQ047SUFBckIsS0FBSyxDQUFDLGFBQWEsQ0FBQzt3REFBYTtBQUNmO0lBQWxCLEtBQUssQ0FBQyxVQUFVLENBQUM7cURBQVU7QUFDRztJQUE5QixLQUFLLENBQUMsc0JBQXNCLENBQUM7aUVBQXNCO0FBQ2xDO0lBQWpCLEtBQUssQ0FBQyxTQUFTLENBQUM7b0RBQVM7QUFDVjtJQUFmLEtBQUssQ0FBQyxPQUFPLENBQUM7a0RBQU87QUFDUDtJQUFkLEtBQUssQ0FBQyxNQUFNLENBQUM7aURBQXFCO0FBTXpCO0lBQVQsTUFBTSxFQUFFOzREQUFzQztBQUUvQztJQURDLEtBQUssRUFBRTtvREFHUDtBQTVCUSxtQkFBbUI7SUFsQi9CLFNBQVMsQ0FBQztRQUNQLFFBQVEsRUFBRSxhQUFhO1FBQ3ZCLGczQ0FBMEM7aUJBQ2pDOzs7Ozs7Ozs7Ozs7S0FZUjtLQUNKLENBQUM7R0FFVyxtQkFBbUIsQ0E2TS9CO1NBN01ZLG1CQUFtQiIsInNvdXJjZXNDb250ZW50IjpbIi8qREVGQVVMVCBHRU5FUkFURUQgVEVNUExBVEUuIERPIE5PVCBDSEFOR0UgU0VMRUNUT1IgVEVNUExBVEVfVVJMIEFORCBDTEFTUyBOQU1FKi9cbmltcG9ydCB7IENvbXBvbmVudCwgQWZ0ZXJWaWV3SW5pdCwgVmlld0NoaWxkLCBJbnB1dCwgT3V0cHV0LCBFdmVudEVtaXR0ZXIgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCAqIGFzIHNpZ25pbmcgZnJvbSAnc2lnbmF0dXJlX3BhZCc7XG4vLyBpbXBvcnQgeyBNYXRTbmFja0JhciB9IGZyb20gJ0Bhbmd1bGFyL21hdGVyaWFsJztcbi8qKlxuKiBNb2RlbCBpbXBvcnQgRXhhbXBsZSA6XG4qIGltcG9ydCB7IEhFUk8gfSBmcm9tICcuLi9tb2RlbHMvaGVyby5tb2RlbCc7XG4qL1xuXG4vKipcbiAqIFNlcnZpY2UgaW1wb3J0IEV4YW1wbGUgOlxuICogaW1wb3J0IHsgSGVyb1NlcnZpY2UgfSBmcm9tICcuLi9zZXJ2aWNlcy9oZXJvL2hlcm8uc2VydmljZSc7XG4gKi9cblxuQENvbXBvbmVudCh7XG4gICAgc2VsZWN0b3I6ICduLXNpZ25hdHVyZScsXG4gICAgdGVtcGxhdGVVcmw6ICcuL24tc2lnbmF0dXJlLnRlbXBsYXRlLmh0bWwnLFxuICAgIHN0eWxlczogW2BcbiAgICAgOmhvc3QgeyBoZWlnaHQ6IDEwMCUgIWltcG9ydGFudDsgfVxuICAgICAuc2lnbmF0dXJlLWNhbnZhcy1mdWxsc2NyZWVuIHtcbiAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcbiAgICAgICAgIHRvcDogMDtcbiAgICAgICAgIGJvdHRvbTogMDtcbiAgICAgICAgIHJpZ2h0OiAwO1xuICAgICAgICAgbGVmdDogMDtcbiAgICAgfVxuICAgICAuc2lnbmF0dXJlLWNvbXBvbmVudC1ib3JkZXIge1xuICAgICAgICAgYm9yZGVyOiAycHggc29saWQgYmxhY2s7XG4gICAgIH1cbiAgICBgXVxufSlcblxuZXhwb3J0IGNsYXNzIE5TaWduYXR1cmVDb21wb25lbnQgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0IHtcblxuICAgIGltYWdlRGF0YVZhbHVlID0gJyc7XG4gICAgcHJpdmF0ZSBzaWduYXR1cmVQYWQ6IGFueSA9ICcnO1xuXG4gICAgQFZpZXdDaGlsZCgnc2lnbmF0dXJlY2FudmFzJywge3N0YXRpYzogZmFsc2V9KSBzaWduYXR1cmVjYW52YXM7XG4gICAgQFZpZXdDaGlsZCgnY2FudmFzcGFyZW50Jywge3N0YXRpYzogZmFsc2V9KSBjYW52YXNwYXJlbnQ7XG5cbiAgICBASW5wdXQoJ2JhY2tncm91bmRDb2xvcicpIGJhY2tncm91bmRDb2xvcjtcbiAgICBASW5wdXQoJ2RvdFNpemUnKSBkb3RTaXplOyAvLyAoZmxvYXQgb3IgZnVuY3Rpb24pIFJhZGl1cyBvZiBhIHNpbmdsZSBkb3QuXG4gICAgQElucHV0KCdtaW5XaWR0aCcpIG1pbldpZHRoOyAvLyAoZmxvYXQpIE1pbmltdW0gd2lkdGggb2YgYSBsaW5lLiBEZWZhdWx0cyB0byAwLjUuXG4gICAgQElucHV0KCdtYXhXaWR0aCcpIG1heFdpZHRoOyAvLyAoZmxvYXQpIE1heGltdW0gd2lkdGggb2YgYSBsaW5lLiBEZWZhdWx0cyB0byAyLjUuXG4gICAgQElucHV0KCd0aHJvdHRsZScpIHRocm90dGxlOyAvLyAoaW50ZWdlcikgRHJhdyB0aGUgbmV4dCBwb2ludCBhdCBtb3N0IG9uY2UgcGVyIGV2ZXJ5IHggbWlsbGlzZWNvbmRzLiBTZXQgaXQgdG8gMCB0byB0dXJuIG9mZiB0aHJvdHRsaW5nLiBEZWZhdWx0cyB0byAxNi5cbiAgICBASW5wdXQoJ21pbkRpc3RhbmNlJykgbWluRGlzdGFuY2U7IC8vIChpbnRlZ2VyKSBBZGQgdGhlIG5leHQgcG9pbnQgb25seSBpZiB0aGUgcHJldmlvdXMgb25lIGlzIGZhcnRoZXIgdGhhbiB4IHBpeGVscy4gRGVmYXVsdHMgdG8gNS4gXG4gICAgQElucHV0KCdwZW5Db2xvcicpIHBlbkNvbG9yOyAvLyAoc3RyaW5nKSBDb2xvciB1c2VkIHRvIGNsZWFyIHRoZSBiYWNrZ3JvdW5kLiBDYW4gYmUgYW55IGNvbG9yIGZvcm1hdCBhY2NlcHRlZCBieSBjb250ZXh0LmZpbGxTdHlsZS4gRGVmYXVsdHMgdG8gXCJyZ2JhKDAsMCwwLDApXCIgKHRyYW5zcGFyZW50IGJsYWNrKS4gVXNlIGEgbm9uLXRyYW5zcGFyZW50IGNvbG9yIGUuZy4gXCJyZ2IoMjU1LDI1NSwyNTUpXCIgKG9wYXF1ZSB3aGl0ZSkgaWYgeW91J2QgbGlrZSB0byBzYXZlIHNpZ25hdHVyZXMgYXMgSlBFRyBpbWFnZXMuXG4gICAgQElucHV0KCd2ZWxvY2l0eUZpbHRlcldlaWdodCcpIHZlbG9jaXR5RmlsdGVyV2VpZ2h0OyAvLyAoZmxvYXQpIFdlaWdodCB1c2VkIHRvIG1vZGlmeSBuZXcgdmVsb2NpdHkgYmFzZWQgb24gdGhlIHByZXZpb3VzIHZlbG9jaXR5LiBEZWZhdWx0cyB0byAwLjcuXG4gICAgQElucHV0KCdvbkJlZ2luJykgb25CZWdpbjsgLy8gKGZ1bmN0aW9uKSBDYWxsYmFjayB3aGVuIHN0cm9rZSBiZWdpbi5cbiAgICBASW5wdXQoJ29uRW5kJykgb25FbmQ7IC8vIChmdW5jdGlvbikgQ2FsbGJhY2sgd2hlbiBzdHJva2UgZW5kLlxuICAgIEBJbnB1dCgnbW9kZScpIG1vZGUgPSAncmVzcG9uc2l2ZSc7IC8vICdjbGljay1mdWxsc2NyZWVuJyBvciAncmVzcG9uc2l2ZSdcbiAgICBjYW52YXNNb2RlID0gJ3Jlc3BvbnNpdmUnOyAvLyAncmVzcG9uc2l2ZScgb3IgJ2Z1bGxzY3JlZW4nXG4gICAgcHJpdmF0ZSBzYXZlZERhdGE7XG4gICAgcHJpdmF0ZSBwcmV2aW91c1NhdmVkRGF0YTtcbiAgICBjbGFzc0FicztcblxuICAgIEBPdXRwdXQoKSBpbWFnZURhdGFDaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyKCk7XG4gICAgQElucHV0KClcbiAgICBnZXQgaW1hZ2VEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy5pbWFnZURhdGFWYWx1ZTtcbiAgICB9XG5cbiAgICBzZXQgaW1hZ2VEYXRhKHZhbCkge1xuICAgICAgICB0aGlzLmltYWdlRGF0YVZhbHVlID0gdmFsO1xuICAgICAgICBpZiAodmFsIHx8IHZhbCA9PT0gJycgfHwgdGhpcy5pc0RhdGFVUkwodmFsKSkge1xuICAgICAgICAgICAgdGhpcy5zYXZlQ2F2YXModmFsKTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLmltYWdlRGF0YUNoYW5nZS5lbWl0KHRoaXMuaW1hZ2VEYXRhVmFsdWUpO1xuICAgIH1cblxuICAgIG5nQWZ0ZXJWaWV3SW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3Jlc3BvbnNpdmUnKSB7XG4gICAgICAgICAgICB0aGlzLmNyZWF0ZUNhbnZhcygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgY3JlYXRlQ2FudmFzKCkge1xuICAgICAgICB0aGlzLmZpdFRvQ29udGFpbmVyKHRoaXMuc2lnbmF0dXJlY2FudmFzLm5hdGl2ZUVsZW1lbnQpO1xuICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZCA9IG5ldyBzaWduaW5nLmRlZmF1bHQodGhpcy5zaWduYXR1cmVjYW52YXMubmF0aXZlRWxlbWVudCwgdGhpcy5hc3NpZ25PcHRpb25zKCkpO1xuICAgIH1cblxuICAgIHNhdmVDYXZhcyhkYXRhVXJsPykge1xuICAgICAgICBpZiAodGhpcy5zaWduYXR1cmVQYWQpIHtcbiAgICAgICAgICAgIGlmICh0aGlzLnNpZ25hdHVyZVBhZC5pc0VtcHR5KCkgfHwgZGF0YVVybCA9PT0gJycpIHtcbiAgICAgICAgICAgICAgICB0aGlzLnNhdmVkRGF0YSA9ICcnO1xuICAgICAgICAgICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkLmNsZWFyKCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaXNEYXRhVVJMKGRhdGFVcmwpKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5zaWduYXR1cmVQYWQuZnJvbURhdGFVUkwoZGF0YVVybCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zYXZlZERhdGEgPSB0aGlzLnNpZ25hdHVyZVBhZC50b0RhdGEoKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgdGhpcy5pbWFnZURhdGEgPSB0aGlzLnNpZ25hdHVyZVBhZC50b0RhdGFVUkwoKTtcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5tb2RlID09PSAnY2xpY2stZnVsbHNjcmVlbicpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zYXZlZERhdGEgPSB0aGlzLnNpZ25hdHVyZVBhZC50b0RhdGEoKTtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5oaWRlQ2FudmFzKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfVxuXG4gICAgY2xlYXJDYW52YXMoKSB7XG4gICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkLmNsZWFyKCk7XG4gICAgICAgIC8vIHRoaXMuZml0VG9Db250YWluZXIodGhpcy5zaWduYXR1cmVjYW52YXMubmF0aXZlRWxlbWVudCk7XG4gICAgfVxuXG4gICAgdW5kb0NhbnZhcygpIHtcbiAgICAgICAgY29uc3QgZGF0YSA9IHRoaXMuc2lnbmF0dXJlUGFkLnRvRGF0YSgpO1xuXG4gICAgICAgIGlmIChkYXRhKSB7XG4gICAgICAgICAgICBkYXRhLnBvcCgpOyAvLyByZW1vdmUgdGhlIGxhc3QgZG90IG9yIGxpbmVcbiAgICAgICAgICAgIHRoaXMuc2lnbmF0dXJlUGFkLmZyb21EYXRhKGRhdGEpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgc2hvd0NhbnZhcygpIHtcbiAgICAgICAgdGhpcy5jbGFzc0FicyA9IHRydWU7XG4gICAgICAgIHRoaXMuY2FudmFzTW9kZSA9ICdmdWxsc2NyZWVuJztcbiAgICAgICAgaWYgKCF0aGlzLnNpZ25hdHVyZVBhZCkge1xuICAgICAgICAgICAgdGhpcy5jcmVhdGVDYW52YXMoKTtcblxuICAgICAgICB9XG4gICAgICAgIHRoaXMuZml0VG9Db250YWluZXIodGhpcy5zaWduYXR1cmVjYW52YXMubmF0aXZlRWxlbWVudCwgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQsIGRvY3VtZW50LmJvZHkuY2xpZW50V2lkdGgpXG4gICAgICAgIHRoaXMuY2xlYXJDYW52YXMoKTtcbiAgICAgICAgdGhpcy5jcmVhdGVDYW52YXNGcm9tRGF0YSgpO1xuICAgIH1cblxuICAgIGhpZGVDYW52YXMoKSB7XG4gICAgICAgIHRoaXMuY2FudmFzTW9kZSA9ICdyZXNwb25zaXZlJztcbiAgICB9XG5cbiAgICAvLyBjYW5jZWwgY3VycmVudGx5IGRyYXduXG4gICAgY2FuY2VsKCkge1xuICAgICAgICB0aGlzLnNhdmVkRGF0YSA9IE9iamVjdC5hc3NpZ24oW10sIHRoaXMucHJldmlvdXNTYXZlZERhdGEpO1xuICAgIH1cblxuICAgIGNyZWF0ZUNhbnZhc0Zyb21EYXRhKCkge1xuICAgICAgICBpZiAodGhpcy5zYXZlZERhdGEpIHtcbiAgICAgICAgICAgIHRoaXMucHJldmlvdXNTYXZlZERhdGEgPSBPYmplY3QuYXNzaWduKHt9LCB0aGlzLnNhdmVkRGF0YSk7XG4gICAgICAgICAgICB0aGlzLnNpZ25hdHVyZVBhZC5mcm9tRGF0YSh0aGlzLnNhdmVkRGF0YSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBwcml2YXRlIGZpdFRvQ29udGFpbmVyKGVsZW1lbnQsIGhlaWdodD8sIHdpZHRoPykge1xuICAgICAgICBlbGVtZW50LnN0eWxlLndpZHRoID0gJzEwMCUnO1xuICAgICAgICBlbGVtZW50LnN0eWxlLmhlaWdodCA9ICdjYWxjKDEwMCUgLSA1NnB4KSc7XG4gICAgICAgIGlmIChoZWlnaHQgJiYgd2lkdGgpIHtcbiAgICAgICAgICAgIGVsZW1lbnQud2lkdGggPSB3aWR0aDtcbiAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gaGVpZ2h0IC0gNTY7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBlbGVtZW50LndpZHRoID0gZWxlbWVudC5vZmZzZXRXaWR0aDtcbiAgICAgICAgICAgIGVsZW1lbnQuaGVpZ2h0ID0gZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgICAgIH1cblxuICAgIH1cblxuICAgIHByaXZhdGUgYXNzaWduT3B0aW9ucygpIHtcbiAgICAgICAgbGV0IG9wdGlvbnMgPSB7fTtcbiAgICAgICAgb3B0aW9uc1snYmFja2dyb3VuZENvbG9yJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kUkdCKHRoaXMuYmFja2dyb3VuZENvbG9yLCAnYmFja2dyb3VuZENvbG9yJylcbiAgICAgICAgb3B0aW9uc1snZG90U2l6ZSddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLmRvdFNpemUsICdkb3RTaXplJyk7XG4gICAgICAgIG9wdGlvbnNbJ21pbldpZHRoJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWluV2lkdGgsICdtaW5XaWR0aCcpO1xuICAgICAgICBvcHRpb25zWydtYXhXaWR0aCddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLm1heFdpZHRoLCAnbWF4V2lkdGgnKTtcbiAgICAgICAgb3B0aW9uc1sndGhyb3R0bGUnXSA9IHRoaXMuY2hlY2tJZlZhbGlkVmFsdWVBbmROdW1iZXIodGhpcy50aHJvdHRsZSwgJ3Rocm90dGxlJyk7XG4gICAgICAgIG9wdGlvbnNbJ21pbkRpc3RhbmNlJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKHRoaXMubWluRGlzdGFuY2UsICdtaW5EaXN0YW5jZScpO1xuICAgICAgICBvcHRpb25zWydwZW5Db2xvciddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZFJHQih0aGlzLnBlbkNvbG9yLCAncGVuQ29sb3InKVxuICAgICAgICBvcHRpb25zWyd2ZWxvY2l0eUZpbHRlcldlaWdodCddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZE51bWJlcih0aGlzLnZlbG9jaXR5RmlsdGVyV2VpZ2h0LCAndmVsb2NpdHlGaWx0ZXJXZWlnaHQnKTtcbiAgICAgICAgb3B0aW9ucyA9IEpTT04ucGFyc2UoSlNPTi5zdHJpbmdpZnkob3B0aW9ucykpOyAvLyByZW1vdmluZyBhbGwgdW5kZWZpbmVkIGZpZWxkc1xuICAgICAgICBvcHRpb25zWydvbkJlZ2luJ10gPSB0aGlzLmNoZWNrSWZWYWxpZFZhbHVlQW5kRnVuY3Rpb24odGhpcy5vbkJlZ2luLCAnb25CZWdpbicpO1xuICAgICAgICBvcHRpb25zWydvbkVuZCddID0gdGhpcy5jaGVja0lmVmFsaWRWYWx1ZUFuZEZ1bmN0aW9uKHRoaXMub25FbmQsICdvbkVuZCcpO1xuICAgICAgICByZXR1cm4gb3B0aW9ucztcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZFZhbHVlQW5kTnVtYmVyKG51bSwgbmFtZSkge1xuICAgICAgICBpZiAodGhpcy5jaGVja0lmVmFsaWQobnVtKSAmJiB0aGlzLmNoZWNrTnVtYmVyKG51bSkpIHtcbiAgICAgICAgICAgIHJldHVybiBudW07XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5pbnZhbGlkVG9hc3QobmFtZSwgJ251bScpO1xuICAgICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJZlZhbGlkVmFsdWVBbmRSR0IoY29sb3IsIG5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tJZlZhbGlkKGNvbG9yKSAmJiB0aGlzLmNoZWNrUkdCKGNvbG9yKSkge1xuICAgICAgICAgICAgcmV0dXJuIGNvbG9yO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW52YWxpZFRvYXN0KG5hbWUsICdyZ2InKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZFZhbHVlQW5kRnVuY3Rpb24oZm4sIG5hbWUpIHtcbiAgICAgICAgaWYgKHRoaXMuY2hlY2tJZlZhbGlkKGZuKSAmJiB0aGlzLmNoZWNrSWZWYWxpZEZ1bmN0aW9uKGZuKSkge1xuICAgICAgICAgICAgcmV0dXJuIGZuO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMuaW52YWxpZFRvYXN0KG5hbWUsICdmdW5jdGlvbiBmb3JtYXQnKTtcbiAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICBwcml2YXRlIGNoZWNrSWZWYWxpZCh2YWx1ZSkge1xuICAgICAgICByZXR1cm4gKHZhbHVlICE9PSB1bmRlZmluZWQgJiYgdmFsdWUgIT09IG51bGwpID8gdmFsdWUgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja051bWJlcihudW0pIHtcbiAgICAgICAgcmV0dXJuICF0aGlzLmNoZWNrSXNOYW4oTnVtYmVyKG51bSkpID8gTnVtYmVyKG51bSkgOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja0lmVmFsaWRGdW5jdGlvbihmbikge1xuICAgICAgICByZXR1cm4gdHlwZW9mIGZuID09PSAnZnVuY3Rpb24nID8gZm4gOiB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgcHJpdmF0ZSBjaGVja1JHQihjb2xvcikge1xuICAgICAgICBjb25zdCBtYXRjaENvbG9yczEgPSBuZXcgUmVnRXhwKC9yZ2JcXCgoXFxkezEsM30pLChcXGR7MSwzfSksKFxcZHsxLDN9KVxcKS8pO1xuICAgICAgICBjb25zdCBtYXRjaENvbG9yczIgPSBuZXcgUmVnRXhwKC9yZ2JcXCgoXFxkezEsM30pLFsgXFx0XSsoXFxkezEsM30pLChcXGR7MSwzfSlcXCkvKTtcbiAgICAgICAgY29uc3QgbWF0Y2hDb2xvcnMzID0gbmV3IFJlZ0V4cCgvcmdiXFwoKFxcZHsxLDN9KSwoXFxkezEsM30pLFsgXFx0XSsoXFxkezEsM30pXFwpLylcbiAgICAgICAgcmV0dXJuIG1hdGNoQ29sb3JzMS50ZXN0KGNvbG9yKSB8fCBtYXRjaENvbG9yczIudGVzdChjb2xvcikgfHwgbWF0Y2hDb2xvcnMzLnRlc3QoY29sb3IpO1xuICAgIH1cblxuICAgIHByaXZhdGUgY2hlY2tJc05hbih2YWx1ZSkge1xuICAgICAgICByZXR1cm4gTnVtYmVyLmlzTmFOKHZhbHVlKTtcbiAgICB9XG5cbiAgICBwcml2YXRlIGludmFsaWRUb2FzdChvcHRpb25OYW1lLCBvcHRpb25UeXBlKSB7XG4gICAgICAgIHN3aXRjaCAob3B0aW9uVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnbnVtJzpcbiAgICAgICAgICAgICAgICAvLyB0aGlzLnNuYWNrYmFyLm9wZW4oYEludmFsaWQgJHtvcHRpb25OYW1lfSAobnVtYmVyIG9yIGZsb2F0KSBnaXZlbiwgdGFraW5nIGRlZmF1bHQgdmFsdWUgaW5zdGVhZC5gLCAnT0snKTtcbiAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIGNhc2UgJ3JnYic6XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5zbmFja2Jhci5vcGVuKGBJbnZhbGlkICR7b3B0aW9uTmFtZX0gZm9ybWF0IEVnOiByZ2IoMjU1LCAyNTUsIDI1NSkgIGdpdmVuLCB0YWtpbmcgZGVmYXVsdCB2YWx1ZSBpbnN0ZWFkLmAsICdPSycpO1xuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBwcml2YXRlIGlzRGF0YVVSTChzKSB7XG4gICAgICAgIGlmIChzKSB7XG4gICAgICAgICAgICBjb25zdCByZWdleCA9IC9eXFxzKmRhdGE6KFthLXpdK1xcL1thLXpdKyg7W2EtelxcLV0rXFw9W2EtelxcLV0rKT8pPyg7YmFzZTY0KT8sW2EtejAtOVxcIVxcJFxcJlxcJ1xcLFxcKFxcKVxcKlxcK1xcLFxcO1xcPVxcLVxcLlxcX1xcflxcOlxcQFxcL1xcP1xcJVxcc10qXFxzKiQvaTtcbiAgICAgICAgICAgIHJldHVybiAhIXMubWF0Y2gocmVnZXgpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgfVxufVxuIl19