/**
 * @fileoverview added by tsickle
 * Generated from: lib/neutrinos-oauth-client.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { __awaiter } from "tslib";
import { Injectable } from '@angular/core';
import { HttpClient, HttpHeaders } from '@angular/common/http';
import { Subject } from 'rxjs';
import { UtilService } from './services/util.service';
import * as i0 from "@angular/core";
import * as i1 from "./services/util.service";
import * as i2 from "@angular/common/http";
export class NeutrinosOAuthClientService {
    /**
     * @param {?} util
     * @param {?} http
     */
    constructor(util, http) {
        this.util = util;
        this.http = http;
        this.cookieName = 'connect.sid';
        this.authStateSubject = new Subject();
    }
    /**
     * Get user info and tokens of the current logged in user
     * @return {?}
     */
    get userInfo() {
        return this.currentUserInfo;
    }
    /**
     * @return {?}
     */
    get isLoggedIn() {
        return this.currentUserInfo ? true : false;
    }
    /**
     * @private
     * @param {?} userInfo
     * @return {?}
     */
    setUserInfo(userInfo) {
        this.currentUserInfo = userInfo;
    }
    /**
     * Performs authentication based on configuration and returns user info for mobile env and
     * for web app user info is stored in memory. Call userInfo getter method to retrieve userinfo
     * @param {?=} redirectBackUrl - url to redirect back to when authentication is done. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    login(redirectBackUrl) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            if (this.util.getEnvValue('isIDSEnabled') === 'false') {
                return reject({ message: 'IDS is not enabled in environments' });
            }
            if (this.util.getPlatformType() === 'browser') {
                this.loginWithRedirect(redirectBackUrl);
                return;
            }
            this.loginWithInAppBrowser()
                .then((/**
             * @param {?} tokenset
             * @return {?}
             */
            tokenset => {
                return resolve(tokenset);
            }))
                .catch((/**
             * @param {?} authError
             * @return {?}
             */
            authError => {
                return reject(authError);
            }));
        }));
    }
    /**
     *
     * @private
     * @return {?}
     */
    loginWithInAppBrowser() {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => __awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const scriptURLS = ['/interaction/', '/auth-provider/return'];
            // execute JS only for this urls
            /** @type {?} */
            const script = yield this.getScript();
            // Get JS which stores guid and device details in local storage of webview
            /** @type {?} */
            const inAppBrowserRef = cordova.InAppBrowser.open(this.util.getMobileLoginUrl(), '_blank');
            /** @type {?} */
            const executeScriptCB = (/**
             * @param {?} event
             * @return {?}
             */
            (event) => {
                if (event && event.hasOwnProperty('type') && event.hasOwnProperty('url') && event.type === 'loadstop'
                    && this.isURLMatch(event.url, scriptURLS)) {
                    inAppBrowserRef.executeScript({ code: script }, (/**
                     * @return {?}
                     */
                    () => { }));
                }
            });
            inAppBrowserRef.addEventListener('loadstop', executeScriptCB);
            /** @type {?} */
            const exitCB = (/**
             * @return {?}
             */
            () => {
                return reject({ code: 'auth-cancel', message: 'Authentication cancelled by user' });
            });
            inAppBrowserRef.addEventListener('message', (/**
             * @param {?} message
             * @return {?}
             */
            (message) => {
                if (message && message.data && message.data.auth && message.data.auth === 'success') {
                    inAppBrowserRef.removeEventListener('exit', exitCB);
                    inAppBrowserRef.close();
                    this.getUserInfo().then((/**
                     * @param {?} tokenset
                     * @return {?}
                     */
                    tokenset => {
                        return resolve(tokenset);
                    })).catch((/**
                     * @param {?} authErr
                     * @return {?}
                     */
                    authErr => {
                        return reject(authErr);
                    }));
                }
            }));
            // settle the promise if user closed the in app browser manually
            inAppBrowserRef.addEventListener('exit', exitCB);
        })));
    }
    /**
     * @private
     * @param {?} url
     * @param {?} compareWith
     * @return {?}
     */
    isURLMatch(url, compareWith) {
        return compareWith.some((/**
         * @param {?} u
         * @return {?}
         */
        u => url.includes(u)));
    }
    /**
     * Returns JS as a string to be executed in inAppBrowser which sets guid and device details in localStorage
     * @private
     * @return {?}
     */
    getScript() {
        return __awaiter(this, void 0, void 0, function* () {
            /** @type {?} */
            const deviceDetails = JSON.stringify(window['device']) || {};
            /** @type {?} */
            const guid = yield this.getuniqueDeviceID();
            /** @type {?} */
            const guidScript = guid ? `localStorage.setItem('guid', '${guid}')` : '';
            /** @type {?} */
            const script = `${guidScript}
          localStorage.setItem('additionalInfo', '${deviceDetails}')
          window.isScriptExecuted = true;`;
            return script;
        });
    }
    /**
     * @private
     * @return {?}
     */
    getuniqueDeviceID() {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            window['plugins'].uniqueDeviceID.get((/**
             * @param {?} guid
             * @return {?}
             */
            (guid) => {
                return resolve(guid);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                return resolve(null);
            }));
        }));
    }
    /**
     * @return {?}
     */
    getUserInfo() {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            /** @type {?} */
            let headers = new HttpHeaders();
            /*Edge case: Userinfo is retreived from cache when login page is opened and user cancels the login attempt  */
            headers = headers.set('Cache-Control', 'no-cache, no-store, must-revalidate');
            headers = headers.set('Pragma', 'no-cache');
            headers = headers.set('Expires', '0');
            this.http.get(this.util.getUserInfoUrl(), { headers }).subscribe((/**
             * @param {?} tokenset
             * @return {?}
             */
            tokenset => {
                this.setUserInfo(tokenset);
                return resolve(tokenset);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            error => {
                this.destroyClientSession();
                return reject(error);
            }));
        }));
    }
    /*If SSD throws 401 during any http request due to refresh token expiry, cookie expiry or access revoke nullify the userinfo in memory
      and emit authState event  */
    /**
     * @param {?} errorResponse
     * @return {?}
     */
    removeUserInfo(errorResponse) {
        this.destroyClientSession();
        this.authStateSubject.next(errorResponse);
    }
    /**
     * Returns event when Auth state has changed due to session expiry, access revoke or cookie expiry.
     * @return {?}
     */
    authState() {
        return this.authStateSubject.asObservable();
    }
    /**
     * @private
     * @param {?} redirectBackUrl
     * @return {?}
     */
    loginWithRedirect(redirectBackUrl) {
        window.location.href = this.util.getWebLoginUrl(redirectBackUrl);
    }
    /**
     * Restores the connect.sid cookie from session storage during app bootstrap if device is mobile
     * @return {?}
     */
    restoreCookies() {
        return __awaiter(this, void 0, void 0, function* () {
            return yield this.getCookie(this.cookieName, this.util.getSSDBasePath())
                .then((/**
             * @param {?} connectSid
             * @return {?}
             */
            (connectSid) => __awaiter(this, void 0, void 0, function* () {
                return yield this.setCookie(this.util.getSSDBasePath(), this.cookieName, connectSid);
            }))).catch((/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                return false;
            }));
        });
    }
    /**
     *
     * @private
     * @param {?} url - site where the cookie is stored
     * @param {?} cookieName - name of the cookie to restore
     * @param {?} cookieValue - value of the cookie to restore
     * @return {?}
     */
    setCookie(url, cookieName, cookieValue) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            cookieMaster.setCookieValue(url, cookieName, cookieValue, (/**
             * @return {?}
             */
            () => {
                return resolve(true);
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                return reject(false);
            }));
        }));
    }
    /**
     *
     * @private
     * @param {?} cookieName          name of the cookie to retrieve
     * @param {?} fullCookieString    String containing all the cookies from an url
     * @return {?}
     */
    readCookieValueFromCookieString(cookieName, fullCookieString) {
        /** @type {?} */
        let cookieNameWithEqualsSign = cookieName + "=";
        /** @type {?} */
        let cookieArray = fullCookieString.split(';');
        for (let i = 0; i < cookieArray.length; i++) {
            /** @type {?} */
            let cookie = cookieArray[i];
            // Remove unnecessary leading spaces from cookie
            while (cookie.charAt(0) == ' ') {
                cookie = cookie.substring(1, cookie.length);
            }
            // Retrieve and return cookie value
            if (cookie.indexOf(cookieNameWithEqualsSign) == 0) {
                return cookie.substring(cookieNameWithEqualsSign.length, cookie.length);
            }
        }
        return null;
    }
    /**
     *
     * @private
     * @param {?} cookieName - name of the cookie to retrieve
     * @param {?} url - site where the cookie is stored
     * @return {?}
     */
    getCookie(cookieName, url) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            window['cordova'].plugins.CookiesPlugin.getCookie(url, (/**
             * @param {?} cookies
             * @return {?}
             */
            (cookies) => {
                /** @type {?} */
                let cookieValue = this.readCookieValueFromCookieString(cookieName, cookies);
                if (cookieValue) {
                    return resolve(cookieValue);
                }
                else {
                    return reject("cookie value null");
                }
            }), (/**
             * @param {?} error
             * @return {?}
             */
            (error) => {
                return reject(error);
            }));
        }));
    }
    /**
     * Logout the current user, destroys session between client and server.
     * @param {?=} redirectBackUrl - URL where the user is navigated post logout. Valid only for Web.
     * For mobile use the Promise returned to perform post authentication actions
     * @return {?}
     */
    logout(redirectBackUrl) {
        /** @type {?} */
        const logoutUrl = (this.util.getPlatformType() === 'browser') ? this.util.getWebLogoutUrl(redirectBackUrl)
            : this.util.getMobileLogoutUrl();
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            this.http.get(logoutUrl).subscribe((/**
             * @param {?} idsLogoutInfo
             * @return {?}
             */
            idsLogoutInfo => {
                this.destroyIDSSession(idsLogoutInfo)
                    .then((/**
                 * @return {?}
                 */
                () => {
                    return resolve();
                }))
                    .catch((/**
                 * @param {?} logoutErr
                 * @return {?}
                 */
                logoutErr => {
                    return reject(logoutErr);
                }));
            }), (/**
             * @param {?} logoutError
             * @return {?}
             */
            logoutError => {
                return reject(logoutError);
            }));
        }));
    }
    /**
     * @private
     * @param {?} idsInfo
     * @return {?}
     */
    destroyIDSSession(idsInfo) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            if (idsInfo['sessionExists'] === false) {
                // No session present with SSD due to cookie expiry
                this.destroyClientSession();
                this.authStateSubject.next({ code: 'NO_SESSION', message: 'User session has already expired' });
                return resolve();
            }
            if (this.util.getPlatformType() === 'browser') {
                window.location.href = idsInfo['idsURL'];
            }
            else {
                this.logoutWithInappBrowser(idsInfo['idsURL'])
                    .then((/**
                 * @return {?}
                 */
                () => {
                    return resolve();
                }))
                    .catch((/**
                 * @param {?} sessionError
                 * @return {?}
                 */
                sessionError => {
                    return reject(sessionError);
                }));
            }
        }));
    }
    /**
     *
     * @private
     * @param {?} idsLogoutUrl - IDS logout url
     * Opens InApp browser and destroys the session
     * @return {?}
     */
    logoutWithInappBrowser(idsLogoutUrl) {
        return new Promise((/**
         * @param {?} resolve
         * @param {?} reject
         * @return {?}
         */
        (resolve, reject) => {
            /** @type {?} */
            const exitCB = (/**
             * @return {?}
             */
            () => {
                return reject({ code: 'auth-cancel', message: 'Authentication cancelled by user' });
            });
            /** @type {?} */
            const inAppBrowserRef = cordova.InAppBrowser.open(idsLogoutUrl, '_blank');
            inAppBrowserRef.addEventListener('message', (/**
             * @param {?} message
             * @return {?}
             */
            (message) => {
                // Remove exit listener if script closed the in app browser
                if (message && message.data && message.data.auth && message.data.auth === 'success') {
                    inAppBrowserRef.removeEventListener('exit', exitCB);
                    inAppBrowserRef.close();
                    this.destroyClientSession();
                    return resolve();
                }
            }));
            // settle the promise if user closed the in app browser manually
            inAppBrowserRef.addEventListener('exit', exitCB);
        }));
    }
    /*Remove persisted cookies in local storage and nullify user info */
    /**
     * @private
     * @return {?}
     */
    destroyClientSession() {
        this.setUserInfo(null);
    }
}
NeutrinosOAuthClientService.decorators = [
    { type: Injectable, args: [{
                providedIn: 'root'
            },] }
];
/** @nocollapse */
NeutrinosOAuthClientService.ctorParameters = () => [
    { type: UtilService },
    { type: HttpClient }
];
/** @nocollapse */ NeutrinosOAuthClientService.ɵprov = i0.ɵɵdefineInjectable({ factory: function NeutrinosOAuthClientService_Factory() { return new NeutrinosOAuthClientService(i0.ɵɵinject(i1.UtilService), i0.ɵɵinject(i2.HttpClient)); }, token: NeutrinosOAuthClientService, providedIn: "root" });
if (false) {
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.cookieName;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.currentUserInfo;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.authStateSubject;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.util;
    /**
     * @type {?}
     * @private
     */
    NeutrinosOAuthClientService.prototype.http;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibmV1dHJpbm9zLW9hdXRoLWNsaWVudC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Ii9ob21lL25ldXRyaW5vcy9Eb2N1bWVudHMvbmV1dHJpbm9zLW1vZHVsZXMtYW5ndWxhci9uZXV0cmlub3MtYXV0aC9wcm9qZWN0cy9uZXV0cmlub3Mtb2F1dGgtY2xpZW50L3NyYy8iLCJzb3VyY2VzIjpbImxpYi9uZXV0cmlub3Mtb2F1dGgtY2xpZW50LnNlcnZpY2UudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsT0FBTyxFQUFFLFVBQVUsRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUMzQyxPQUFPLEVBQUUsVUFBVSxFQUFFLFdBQVcsRUFBRSxNQUFNLHNCQUFzQixDQUFDO0FBQy9ELE9BQU8sRUFBYyxPQUFPLEVBQUUsTUFBTSxNQUFNLENBQUM7QUFDM0MsT0FBTyxFQUFFLFdBQVcsRUFBRSxNQUFNLHlCQUF5QixDQUFDOzs7O0FBUXRELE1BQU0sT0FBTywyQkFBMkI7Ozs7O0lBT3RDLFlBQW9CLElBQWlCLEVBQVUsSUFBZ0I7UUFBM0MsU0FBSSxHQUFKLElBQUksQ0FBYTtRQUFVLFNBQUksR0FBSixJQUFJLENBQVk7UUFMdkQsZUFBVSxHQUFHLGFBQWEsQ0FBQztRQUczQixxQkFBZ0IsR0FBRyxJQUFJLE9BQU8sRUFBRSxDQUFDO0lBR3pDLENBQUM7Ozs7O0lBS0QsSUFBSSxRQUFRO1FBQ1YsT0FBTyxJQUFJLENBQUMsZUFBZSxDQUFDO0lBQzlCLENBQUM7Ozs7SUFFRCxJQUFJLFVBQVU7UUFDWixPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxDQUFDLENBQUMsS0FBSyxDQUFDO0lBQzdDLENBQUM7Ozs7OztJQUVPLFdBQVcsQ0FBQyxRQUFRO1FBQzFCLElBQUksQ0FBQyxlQUFlLEdBQUcsUUFBUSxDQUFDO0lBQ2xDLENBQUM7Ozs7Ozs7O0lBUU0sS0FBSyxDQUFDLGVBQXdCO1FBQ25DLE9BQU8sSUFBSSxPQUFPOzs7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U0FBUyxFQUFFO29CQUNuRixlQUFlLENBQUMsbUJBQW1CLENBQUMsTUFBTSxFQUFFLE1BQU0sQ0FBQyxDQUFDO29CQUNwRCxlQUFlLENBQUMsS0FBSyxFQUFFLENBQUM7b0JBQ3hCLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxDQUFDO29CQUM1QixPQUFPLE9BQU8sRUFBRSxDQUFDO2lCQUNsQjtZQUNILENBQUMsRUFBQyxDQUFDO1lBQ0gsZ0VBQWdFO1lBQ2hFLGVBQWUsQ0FBQyxnQkFBZ0IsQ0FBQyxNQUFNLEVBQUUsTUFBTSxDQUFDLENBQUM7UUFDbkQsQ0FBQyxFQUFDLENBQUM7SUFDTCxDQUFDOzs7Ozs7SUFHTyxvQkFBb0I7UUFDMUIsSUFBSSxDQUFDLFdBQVcsQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUN6QixDQUFDOzs7WUF2U0YsVUFBVSxTQUFDO2dCQUNWLFVBQVUsRUFBRSxNQUFNO2FBQ25COzs7O1lBUFEsV0FBVztZQUZYLFVBQVU7Ozs7Ozs7O0lBWWpCLGlEQUFtQzs7Ozs7SUFDbkMsc0RBQXdCOzs7OztJQUV4Qix1REFBeUM7Ozs7O0lBRTdCLDJDQUF5Qjs7Ozs7SUFBRSwyQ0FBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgeyBIdHRwQ2xpZW50LCBIdHRwSGVhZGVycyB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbi9odHRwJztcbmltcG9ydCB7IE9ic2VydmFibGUsIFN1YmplY3QgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IFV0aWxTZXJ2aWNlIH0gZnJvbSAnLi9zZXJ2aWNlcy91dGlsLnNlcnZpY2UnO1xuXG5kZWNsYXJlIGNvbnN0IGNvcmRvdmE7XG5kZWNsYXJlIGNvbnN0IGNvb2tpZU1hc3RlcjtcblxuQEluamVjdGFibGUoe1xuICBwcm92aWRlZEluOiAncm9vdCdcbn0pXG5leHBvcnQgY2xhc3MgTmV1dHJpbm9zT0F1dGhDbGllbnRTZXJ2aWNlIHtcblxuICBwcml2YXRlIGNvb2tpZU5hbWUgPSAnY29ubmVjdC5zaWQnO1xuICBwcml2YXRlIGN1cnJlbnRVc2VySW5mbztcblxuICBwcml2YXRlIGF1dGhTdGF0ZVN1YmplY3QgPSBuZXcgU3ViamVjdCgpO1xuXG4gIGNvbnN0cnVjdG9yKHByaXZhdGUgdXRpbDogVXRpbFNlcnZpY2UsIHByaXZhdGUgaHR0cDogSHR0cENsaWVudCkge1xuICB9XG5cbiAgLyoqXG4gICAqIEdldCB1c2VyIGluZm8gYW5kIHRva2VucyBvZiB0aGUgY3VycmVudCBsb2dnZWQgaW4gdXNlclxuICAgKi9cbiAgZ2V0IHVzZXJJbmZvKCkge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRVc2VySW5mbztcbiAgfVxuXG4gIGdldCBpc0xvZ2dlZEluKCk6IGJvb2xlYW4ge1xuICAgIHJldHVybiB0aGlzLmN1cnJlbnRVc2VySW5mbyA/IHRydWUgOiBmYWxzZTtcbiAgfVxuXG4gIHByaXZhdGUgc2V0VXNlckluZm8odXNlckluZm8pIHtcbiAgICB0aGlzLmN1cnJlbnRVc2VySW5mbyA9IHVzZXJJbmZvO1xuICB9XG5cbiAgLyoqXG4gICAqIFBlcmZvcm1zIGF1dGhlbnRpY2F0aW9uIGJhc2VkIG9uIGNvbmZpZ3VyYXRpb24gYW5kIHJldHVybnMgdXNlciBpbmZvIGZvciBtb2JpbGUgZW52IGFuZFxuICAgKiBmb3Igd2ViIGFwcCB1c2VyIGluZm8gaXMgc3RvcmVkIGluIG1lbW9yeS4gQ2FsbCB1c2VySW5mbyBnZXR0ZXIgbWV0aG9kIHRvIHJldHJpZXZlIHVzZXJpbmZvXG4gICAqIEBwYXJhbSByZWRpcmVjdEJhY2tVcmwgLSB1cmwgdG8gcmVkaXJlY3QgYmFjayB0byB3aGVuIGF1dGhlbnRpY2F0aW9uIGlzIGRvbmUuIFZhbGlkIG9ubHkgZm9yIFdlYi5cbiAgICogRm9yIG1vYmlsZSB1c2UgdGhlIFByb21pc2UgcmV0dXJuZWQgdG8gcGVyZm9ybSBwb3N0IGF1dGhlbnRpY2F0aW9uIGFjdGlvbnNcbiAgICovXG4gIHB1YmxpYyBsb2dpbihyZWRpcmVjdEJhY2tVcmw/OiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgaWYgKHRoaXMudXRpbC5nZXRFbnZWYWx1ZSgnaXNJRFNFbmFibGVkJykgPT09ICdmYWxzZScpIHtcbiAgICAgICAgcmV0dXJuIHJlamVjdCh7IG1lc3NhZ2U6ICdJRFMgaXMgbm90IGVuYWJsZWQgaW4gZW52aXJvbm1lbnRzJyB9KTtcbiAgICAgIH1cbiAgICAgIGlmICh0aGlzLnV0aWwuZ2V0UGxhdGZvcm1UeXBlKCkgPT09ICdicm93c2VyJykge1xuICAgICAgICB0aGlzLmxvZ2luV2l0aFJlZGlyZWN0KHJlZGlyZWN0QmFja1VybCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHRoaXMubG9naW5XaXRoSW5BcHBCcm93c2VyKClcbiAgICAgICAgLnRoZW4odG9rZW5zZXQgPT4ge1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKHRva2Vuc2V0KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGF1dGhFcnJvciA9PiB7XG4gICAgICAgICAgcmV0dXJuIHJlamVjdChhdXRoRXJyb3IpO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gbG9naW5VcmwgLSBMb2dpbiB1cmwgd2hlcmUgU1NEIGlzIGhvc3RlZFxuICAgKi9cbiAgcHJpdmF0ZSBsb2dpbldpdGhJbkFwcEJyb3dzZXIoKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKGFzeW5jIChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IHNjcmlwdFVSTFMgPSBbJy9pbnRlcmFjdGlvbi8nLCAnL2F1dGgtcHJvdmlkZXIvcmV0dXJuJ107IC8vIGV4ZWN1dGUgSlMgb25seSBmb3IgdGhpcyB1cmxzXG4gICAgICBjb25zdCBzY3JpcHQgPSBhd2FpdCB0aGlzLmdldFNjcmlwdCgpOyAvLyBHZXQgSlMgd2hpY2ggc3RvcmVzIGd1aWQgYW5kIGRldmljZSBkZXRhaWxzIGluIGxvY2FsIHN0b3JhZ2Ugb2Ygd2Vidmlld1xuICAgICAgY29uc3QgaW5BcHBCcm93c2VyUmVmID0gY29yZG92YS5JbkFwcEJyb3dzZXIub3Blbih0aGlzLnV0aWwuZ2V0TW9iaWxlTG9naW5VcmwoKSwgJ19ibGFuaycpO1xuICAgICAgY29uc3QgZXhlY3V0ZVNjcmlwdENCID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIGlmIChldmVudCAmJiBldmVudC5oYXNPd25Qcm9wZXJ0eSgndHlwZScpICYmIGV2ZW50Lmhhc093blByb3BlcnR5KCd1cmwnKSAmJiBldmVudC50eXBlID09PSAnbG9hZHN0b3AnXG4gICAgICAgICAgJiYgdGhpcy5pc1VSTE1hdGNoKGV2ZW50LnVybCwgc2NyaXB0VVJMUykpIHtcbiAgICAgICAgICBpbkFwcEJyb3dzZXJSZWYuZXhlY3V0ZVNjcmlwdCh7IGNvZGU6IHNjcmlwdCB9LCAoKSA9PiB7IH0pO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgaW5BcHBCcm93c2VyUmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2xvYWRzdG9wJywgZXhlY3V0ZVNjcmlwdENCKTtcbiAgICAgIGNvbnN0IGV4aXRDQiA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlamVjdCh7IGNvZGU6ICdhdXRoLWNhbmNlbCcsIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBjYW5jZWxsZWQgYnkgdXNlcicgfSk7XG4gICAgICB9O1xuICAgICAgaW5BcHBCcm93c2VyUmVmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAobWVzc2FnZSkgPT4ge1xuICAgICAgICBpZiAobWVzc2FnZSAmJiBtZXNzYWdlLmRhdGEgJiYgbWVzc2FnZS5kYXRhLmF1dGggJiYgbWVzc2FnZS5kYXRhLmF1dGggPT09ICdzdWNjZXNzJykge1xuICAgICAgICAgIGluQXBwQnJvd3NlclJlZi5yZW1vdmVFdmVudExpc3RlbmVyKCdleGl0JywgZXhpdENCKTtcbiAgICAgICAgICBpbkFwcEJyb3dzZXJSZWYuY2xvc2UoKTtcbiAgICAgICAgICB0aGlzLmdldFVzZXJJbmZvKCkudGhlbih0b2tlbnNldCA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVzb2x2ZSh0b2tlbnNldCk7XG4gICAgICAgICAgfSkuY2F0Y2goYXV0aEVyciA9PiB7XG4gICAgICAgICAgICByZXR1cm4gcmVqZWN0KGF1dGhFcnIpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIC8vIHNldHRsZSB0aGUgcHJvbWlzZSBpZiB1c2VyIGNsb3NlZCB0aGUgaW4gYXBwIGJyb3dzZXIgbWFudWFsbHlcbiAgICAgIGluQXBwQnJvd3NlclJlZi5hZGRFdmVudExpc3RlbmVyKCdleGl0JywgZXhpdENCKTtcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgaXNVUkxNYXRjaCh1cmwsIGNvbXBhcmVXaXRoOiBBcnJheTxzdHJpbmc+KSB7XG4gICAgcmV0dXJuIGNvbXBhcmVXaXRoLnNvbWUodSA9PiB1cmwuaW5jbHVkZXModSkpO1xuICB9XG5cblxuICAvKipcbiAgICogUmV0dXJucyBKUyBhcyBhIHN0cmluZyB0byBiZSBleGVjdXRlZCBpbiBpbkFwcEJyb3dzZXIgd2hpY2ggc2V0cyBndWlkIGFuZCBkZXZpY2UgZGV0YWlscyBpbiBsb2NhbFN0b3JhZ2VcbiAgICovXG4gIHByaXZhdGUgYXN5bmMgZ2V0U2NyaXB0KCkge1xuICAgIGNvbnN0IGRldmljZURldGFpbHMgPSBKU09OLnN0cmluZ2lmeSh3aW5kb3dbJ2RldmljZSddKSB8fCB7fTtcbiAgICBjb25zdCBndWlkID0gYXdhaXQgdGhpcy5nZXR1bmlxdWVEZXZpY2VJRCgpO1xuICAgIGNvbnN0IGd1aWRTY3JpcHQgPSBndWlkID8gYGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdndWlkJywgJyR7Z3VpZH0nKWAgOiAnJztcbiAgICBjb25zdCBzY3JpcHQgPSBgJHtndWlkU2NyaXB0fVxuICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdhZGRpdGlvbmFsSW5mbycsICcke2RldmljZURldGFpbHN9JylcbiAgICAgICAgICB3aW5kb3cuaXNTY3JpcHRFeGVjdXRlZCA9IHRydWU7YDtcbiAgICByZXR1cm4gc2NyaXB0O1xuICB9XG5cbiAgcHJpdmF0ZSBnZXR1bmlxdWVEZXZpY2VJRCgpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgd2luZG93WydwbHVnaW5zJ10udW5pcXVlRGV2aWNlSUQuZ2V0KChndWlkKSA9PiB7XG4gICAgICAgIHJldHVybiByZXNvbHZlKGd1aWQpO1xuICAgICAgfSwgZXJyb3IgPT4ge1xuICAgICAgICByZXR1cm4gcmVzb2x2ZShudWxsKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cblxuICBwdWJsaWMgZ2V0VXNlckluZm8oKTogUHJvbWlzZTx7fT4ge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICBsZXQgaGVhZGVycyA9IG5ldyBIdHRwSGVhZGVycygpO1xuICAgICAgLypFZGdlIGNhc2U6IFVzZXJpbmZvIGlzIHJldHJlaXZlZCBmcm9tIGNhY2hlIHdoZW4gbG9naW4gcGFnZSBpcyBvcGVuZWQgYW5kIHVzZXIgY2FuY2VscyB0aGUgbG9naW4gYXR0ZW1wdCAgKi9cbiAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnQ2FjaGUtQ29udHJvbCcsICduby1jYWNoZSwgbm8tc3RvcmUsIG11c3QtcmV2YWxpZGF0ZScpO1xuICAgICAgaGVhZGVycyA9IGhlYWRlcnMuc2V0KCdQcmFnbWEnLCAnbm8tY2FjaGUnKTtcbiAgICAgIGhlYWRlcnMgPSBoZWFkZXJzLnNldCgnRXhwaXJlcycsICcwJyk7XG4gICAgICB0aGlzLmh0dHAuZ2V0KHRoaXMudXRpbC5nZXRVc2VySW5mb1VybCgpLCB7IGhlYWRlcnMgfSkuc3Vic2NyaWJlKHRva2Vuc2V0ID0+IHtcbiAgICAgICAgdGhpcy5zZXRVc2VySW5mbyh0b2tlbnNldCk7XG4gICAgICAgIHJldHVybiByZXNvbHZlKHRva2Vuc2V0KTtcbiAgICAgIH0sIGVycm9yID0+IHtcbiAgICAgICAgdGhpcy5kZXN0cm95Q2xpZW50U2Vzc2lvbigpO1xuICAgICAgICByZXR1cm4gcmVqZWN0KGVycm9yKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgLypJZiBTU0QgdGhyb3dzIDQwMSBkdXJpbmcgYW55IGh0dHAgcmVxdWVzdCBkdWUgdG8gcmVmcmVzaCB0b2tlbiBleHBpcnksIGNvb2tpZSBleHBpcnkgb3IgYWNjZXNzIHJldm9rZSBudWxsaWZ5IHRoZSB1c2VyaW5mbyBpbiBtZW1vcnlcbiAgYW5kIGVtaXQgYXV0aFN0YXRlIGV2ZW50ICAqL1xuICBwdWJsaWMgcmVtb3ZlVXNlckluZm8oZXJyb3JSZXNwb25zZSkge1xuICAgIHRoaXMuZGVzdHJveUNsaWVudFNlc3Npb24oKTtcbiAgICB0aGlzLmF1dGhTdGF0ZVN1YmplY3QubmV4dChlcnJvclJlc3BvbnNlKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGV2ZW50IHdoZW4gQXV0aCBzdGF0ZSBoYXMgY2hhbmdlZCBkdWUgdG8gc2Vzc2lvbiBleHBpcnksIGFjY2VzcyByZXZva2Ugb3IgY29va2llIGV4cGlyeS5cbiAgICovXG4gIHB1YmxpYyBhdXRoU3RhdGUoKTogT2JzZXJ2YWJsZTxhbnk+IHtcbiAgICByZXR1cm4gdGhpcy5hdXRoU3RhdGVTdWJqZWN0LmFzT2JzZXJ2YWJsZSgpO1xuICB9XG5cbiAgcHJpdmF0ZSBsb2dpbldpdGhSZWRpcmVjdChyZWRpcmVjdEJhY2tVcmwpOiB2b2lkIHtcbiAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9IHRoaXMudXRpbC5nZXRXZWJMb2dpblVybChyZWRpcmVjdEJhY2tVcmwpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJlc3RvcmVzIHRoZSBjb25uZWN0LnNpZCBjb29raWUgZnJvbSBzZXNzaW9uIHN0b3JhZ2UgZHVyaW5nIGFwcCBib290c3RyYXAgaWYgZGV2aWNlIGlzIG1vYmlsZVxuICAgKi9cbiAgcHVibGljIGFzeW5jIHJlc3RvcmVDb29raWVzKCkge1xuICAgIHJldHVybiBhd2FpdCB0aGlzLmdldENvb2tpZSh0aGlzLmNvb2tpZU5hbWUsIHRoaXMudXRpbC5nZXRTU0RCYXNlUGF0aCgpKVxuICAgIC50aGVuKGFzeW5jIChjb25uZWN0U2lkKSA9PiB7XG4gICAgICByZXR1cm4gYXdhaXQgdGhpcy5zZXRDb29raWUodGhpcy51dGlsLmdldFNTREJhc2VQYXRoKCksIHRoaXMuY29va2llTmFtZSwgY29ubmVjdFNpZCk7XG4gICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtIHVybCAtIHNpdGUgd2hlcmUgdGhlIGNvb2tpZSBpcyBzdG9yZWRcbiAgICogQHBhcmFtIGNvb2tpZU5hbWUgLSBuYW1lIG9mIHRoZSBjb29raWUgdG8gcmVzdG9yZVxuICAgKiBAcGFyYW0gY29va2llVmFsdWUgLSB2YWx1ZSBvZiB0aGUgY29va2llIHRvIHJlc3RvcmVcbiAgICovXG4gIHByaXZhdGUgc2V0Q29va2llKHVybDogc3RyaW5nLCBjb29raWVOYW1lOiBzdHJpbmcsIGNvb2tpZVZhbHVlOiBzdHJpbmcpIHtcbiAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgY29va2llTWFzdGVyLnNldENvb2tpZVZhbHVlKHVybCwgY29va2llTmFtZSwgY29va2llVmFsdWUsICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlc29sdmUodHJ1ZSk7XG4gICAgICB9LCAoZXJyb3IpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlamVjdChmYWxzZSk7XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKlxuICAgKiBAcGFyYW0gY29va2llTmFtZSAgICAgICAgICBuYW1lIG9mIHRoZSBjb29raWUgdG8gcmV0cmlldmVcbiAgICogQHBhcmFtIGZ1bGxDb29raWVTdHJpbmcgICAgU3RyaW5nIGNvbnRhaW5pbmcgYWxsIHRoZSBjb29raWVzIGZyb20gYW4gdXJsXG4gICAqL1xuICBwcml2YXRlIHJlYWRDb29raWVWYWx1ZUZyb21Db29raWVTdHJpbmcoY29va2llTmFtZSwgZnVsbENvb2tpZVN0cmluZykge1xuICAgIGxldCBjb29raWVOYW1lV2l0aEVxdWFsc1NpZ24gPSBjb29raWVOYW1lICsgXCI9XCI7XG4gICAgbGV0IGNvb2tpZUFycmF5ID0gZnVsbENvb2tpZVN0cmluZy5zcGxpdCgnOycpO1xuICAgIGZvcihsZXQgaT0wO2kgPCBjb29raWVBcnJheS5sZW5ndGg7aSsrKSB7XG4gICAgICAgIGxldCBjb29raWUgPSBjb29raWVBcnJheVtpXTtcbiAgICAgICAgLy8gUmVtb3ZlIHVubmVjZXNzYXJ5IGxlYWRpbmcgc3BhY2VzIGZyb20gY29va2llXG4gICAgICAgIHdoaWxlIChjb29raWUuY2hhckF0KDApPT0nICcpIHtcbiAgICAgICAgICBjb29raWUgPSBjb29raWUuc3Vic3RyaW5nKDEsY29va2llLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gUmV0cmlldmUgYW5kIHJldHVybiBjb29raWUgdmFsdWVcbiAgICAgICAgaWYgKGNvb2tpZS5pbmRleE9mKGNvb2tpZU5hbWVXaXRoRXF1YWxzU2lnbikgPT0gMCkge1xuICAgICAgICAgIHJldHVybiBjb29raWUuc3Vic3RyaW5nKGNvb2tpZU5hbWVXaXRoRXF1YWxzU2lnbi5sZW5ndGgsY29va2llLmxlbmd0aCk7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICpcbiAgICogQHBhcmFtICBjb29raWVOYW1lIC0gbmFtZSBvZiB0aGUgY29va2llIHRvIHJldHJpZXZlXG4gICAqIEBwYXJhbSAgIHVybCAtIHNpdGUgd2hlcmUgdGhlIGNvb2tpZSBpcyBzdG9yZWRcbiAgICovXG4gIHByaXZhdGUgZ2V0Q29va2llKGNvb2tpZU5hbWU6IHN0cmluZywgdXJsOiBzdHJpbmcpOiBhbnkge1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB3aW5kb3dbJ2NvcmRvdmEnXS5wbHVnaW5zLkNvb2tpZXNQbHVnaW4uZ2V0Q29va2llKHVybCwgKGNvb2tpZXMpID0+IHtcbiAgICAgICAgbGV0IGNvb2tpZVZhbHVlID0gdGhpcy5yZWFkQ29va2llVmFsdWVGcm9tQ29va2llU3RyaW5nKGNvb2tpZU5hbWUsY29va2llcyk7XG4gICAgICAgIGlmKGNvb2tpZVZhbHVlKSB7XG4gICAgICAgICAgcmV0dXJuIHJlc29sdmUoY29va2llVmFsdWUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiByZWplY3QoXCJjb29raWUgdmFsdWUgbnVsbFwiKTtcbiAgICAgICAgfVxuICAgICAgfSwgKGVycm9yKSA9PiB7XG4gICAgICAgIHJldHVybiByZWplY3QoZXJyb3IpO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogTG9nb3V0IHRoZSBjdXJyZW50IHVzZXIsIGRlc3Ryb3lzIHNlc3Npb24gYmV0d2VlbiBjbGllbnQgYW5kIHNlcnZlci5cbiAgICogQHBhcmFtIHJlZGlyZWN0QmFja1VybCAtIFVSTCB3aGVyZSB0aGUgdXNlciBpcyBuYXZpZ2F0ZWQgcG9zdCBsb2dvdXQuIFZhbGlkIG9ubHkgZm9yIFdlYi5cbiAgICogRm9yIG1vYmlsZSB1c2UgdGhlIFByb21pc2UgcmV0dXJuZWQgdG8gcGVyZm9ybSBwb3N0IGF1dGhlbnRpY2F0aW9uIGFjdGlvbnNcbiAgICovXG4gIHB1YmxpYyBsb2dvdXQocmVkaXJlY3RCYWNrVXJsPzogc3RyaW5nKTogUHJvbWlzZTx7fT4ge1xuICAgIGNvbnN0IGxvZ291dFVybCA9ICh0aGlzLnV0aWwuZ2V0UGxhdGZvcm1UeXBlKCkgPT09ICdicm93c2VyJykgPyB0aGlzLnV0aWwuZ2V0V2ViTG9nb3V0VXJsKHJlZGlyZWN0QmFja1VybClcbiAgICAgIDogdGhpcy51dGlsLmdldE1vYmlsZUxvZ291dFVybCgpO1xuICAgIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmh0dHAuZ2V0KGxvZ291dFVybCkuc3Vic2NyaWJlKGlkc0xvZ291dEluZm8gPT4ge1xuICAgICAgICB0aGlzLmRlc3Ryb3lJRFNTZXNzaW9uKGlkc0xvZ291dEluZm8pXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChsb2dvdXRFcnIgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChsb2dvdXRFcnIpO1xuICAgICAgICAgIH0pO1xuICAgICAgfSwgbG9nb3V0RXJyb3IgPT4ge1xuICAgICAgICByZXR1cm4gcmVqZWN0KGxvZ291dEVycm9yKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSBkZXN0cm95SURTU2Vzc2lvbihpZHNJbmZvKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGlmIChpZHNJbmZvWydzZXNzaW9uRXhpc3RzJ10gPT09IGZhbHNlKSB7XG4gICAgICAgIC8vIE5vIHNlc3Npb24gcHJlc2VudCB3aXRoIFNTRCBkdWUgdG8gY29va2llIGV4cGlyeVxuICAgICAgICB0aGlzLmRlc3Ryb3lDbGllbnRTZXNzaW9uKCk7XG4gICAgICAgIHRoaXMuYXV0aFN0YXRlU3ViamVjdC5uZXh0KHsgY29kZTogJ05PX1NFU1NJT04nLCBtZXNzYWdlOiAnVXNlciBzZXNzaW9uIGhhcyBhbHJlYWR5IGV4cGlyZWQnIH0pO1xuICAgICAgICByZXR1cm4gcmVzb2x2ZSgpO1xuICAgICAgfVxuICAgICAgaWYgKHRoaXMudXRpbC5nZXRQbGF0Zm9ybVR5cGUoKSA9PT0gJ2Jyb3dzZXInKSB7XG4gICAgICAgIHdpbmRvdy5sb2NhdGlvbi5ocmVmID0gaWRzSW5mb1snaWRzVVJMJ107XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLmxvZ291dFdpdGhJbmFwcEJyb3dzZXIoaWRzSW5mb1snaWRzVVJMJ10pXG4gICAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlc29sdmUoKTtcbiAgICAgICAgICB9KVxuICAgICAgICAgIC5jYXRjaChzZXNzaW9uRXJyb3IgPT4ge1xuICAgICAgICAgICAgcmV0dXJuIHJlamVjdChzZXNzaW9uRXJyb3IpO1xuICAgICAgICAgIH0pO1xuICAgICAgfVxuICAgIH0pO1xuICB9XG5cbiAgLyoqXG4gICAqXG4gICAqIEBwYXJhbSBpZHNMb2dvdXRVcmwgLSBJRFMgbG9nb3V0IHVybFxuICAgKiBPcGVucyBJbkFwcCBicm93c2VyIGFuZCBkZXN0cm95cyB0aGUgc2Vzc2lvblxuICAgKi9cbiAgcHJpdmF0ZSBsb2dvdXRXaXRoSW5hcHBCcm93c2VyKGlkc0xvZ291dFVybDogc3RyaW5nKSB7XG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIGNvbnN0IGV4aXRDQiA9ICgpID0+IHtcbiAgICAgICAgcmV0dXJuIHJlamVjdCh7IGNvZGU6ICdhdXRoLWNhbmNlbCcsIG1lc3NhZ2U6ICdBdXRoZW50aWNhdGlvbiBjYW5jZWxsZWQgYnkgdXNlcicgfSk7XG4gICAgICB9O1xuICAgICAgY29uc3QgaW5BcHBCcm93c2VyUmVmID0gY29yZG92YS5JbkFwcEJyb3dzZXIub3BlbihpZHNMb2dvdXRVcmwsICdfYmxhbmsnKTtcbiAgICAgIGluQXBwQnJvd3NlclJlZi5hZGRFdmVudExpc3RlbmVyKCdtZXNzYWdlJywgKG1lc3NhZ2UpID0+IHtcbiAgICAgICAgLy8gUmVtb3ZlIGV4aXQgbGlzdGVuZXIgaWYgc2NyaXB0IGNsb3NlZCB0aGUgaW4gYXBwIGJyb3dzZXJcbiAgICAgICAgaWYgKG1lc3NhZ2UgJiYgbWVzc2FnZS5kYXRhICYmIG1lc3NhZ2UuZGF0YS5hdXRoICYmIG1lc3NhZ2UuZGF0YS5hdXRoID09PSAnc3VjY2VzcycpIHtcbiAgICAgICAgICBpbkFwcEJyb3dzZXJSZWYucmVtb3ZlRXZlbnRMaXN0ZW5lcignZXhpdCcsIGV4aXRDQik7XG4gICAgICAgICAgaW5BcHBCcm93c2VyUmVmLmNsb3NlKCk7XG4gICAgICAgICAgdGhpcy5kZXN0cm95Q2xpZW50U2Vzc2lvbigpO1xuICAgICAgICAgIHJldHVybiByZXNvbHZlKCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgICAgLy8gc2V0dGxlIHRoZSBwcm9taXNlIGlmIHVzZXIgY2xvc2VkIHRoZSBpbiBhcHAgYnJvd3NlciBtYW51YWxseVxuICAgICAgaW5BcHBCcm93c2VyUmVmLmFkZEV2ZW50TGlzdGVuZXIoJ2V4aXQnLCBleGl0Q0IpO1xuICAgIH0pO1xuICB9XG5cbiAgLypSZW1vdmUgcGVyc2lzdGVkIGNvb2tpZXMgaW4gbG9jYWwgc3RvcmFnZSBhbmQgbnVsbGlmeSB1c2VyIGluZm8gKi9cbiAgcHJpdmF0ZSBkZXN0cm95Q2xpZW50U2Vzc2lvbigpIHtcbiAgICB0aGlzLnNldFVzZXJJbmZvKG51bGwpO1xuICB9XG5cbn1cbiJdfQ==