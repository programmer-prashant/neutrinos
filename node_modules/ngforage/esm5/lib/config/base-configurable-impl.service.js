/**
 * @fileoverview added by tsickle
 * Generated from: lib/config/base-configurable-impl.service.ts
 * @suppress {checkTypes,constantProperty,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Inject, Injectable } from '@angular/core';
import 'localforage';
import { InstanceFactory } from '../instance-factory/instance-factory.service';
import { NgForageConfig } from './ng-forage-config.service';
/**
 * \@internal
 * @type {?}
 */
var store$ = Symbol('Store');
/**
 * Abstract service-level configuration layer for NgForage
 * @abstract
 */
var BaseConfigurableImpl = /** @class */ (function () {
    /** @internal */
    function BaseConfigurableImpl(config, instanceFactory) {
        /**
         * \@internal
         */
        this.config = {};
        /**
         * \@internal
         */
        this.storeNeedsRecalc = true;
        this.baseConfig = config;
        this.fact = instanceFactory;
    }
    Object.defineProperty(BaseConfigurableImpl.prototype, "description", {
        /**
         * A description of the database, essentially for developer usage.
         * @default ""
         */
        get: /**
         * A description of the database, essentially for developer usage.
         * \@default ""
         * @return {?}
         */
        function () {
            return this.config.description || this.baseConfig.description;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.description = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "driver", {
        /**
         * The preferred driver(s) to use.
         * @default IndexedDB, WebSQL and localStorage
         */
        get: /**
         * The preferred driver(s) to use.
         * \@default IndexedDB, WebSQL and localStorage
         * @return {?}
         */
        function () {
            return this.config.driver || this.baseConfig.driver;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.driver = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "name", {
        /**
         * The name of the database. May appear during storage limit prompts. Useful to use the name of your app here.
         * In localStorage, this is used as a key prefix for all keys stored in localStorage.
         * @default ngForage
         */
        get: /**
         * The name of the database. May appear during storage limit prompts. Useful to use the name of your app here.
         * In localStorage, this is used as a key prefix for all keys stored in localStorage.
         * \@default ngForage
         * @return {?}
         */
        function () {
            return this.config.name || this.baseConfig.name;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.name = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "size", {
        /**
         * The size of the database in bytes. Used only in WebSQL for now.
         * @default 4980736
         */
        get: /**
         * The size of the database in bytes. Used only in WebSQL for now.
         * \@default 4980736
         * @return {?}
         */
        function () {
            return this.config.size || this.baseConfig.size;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.size = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "storeName", {
        /**
         * The name of the datastore.
         * In IndexedDB this is the dataStore,
         * in WebSQL this is the name of the key/value table in the database.
         * Must be alphanumeric, with underscores.
         * Any non-alphanumeric characters will be converted to underscores.
         * @default ng_forage
         */
        get: /**
         * The name of the datastore.
         * In IndexedDB this is the dataStore,
         * in WebSQL this is the name of the key/value table in the database.
         * Must be alphanumeric, with underscores.
         * Any non-alphanumeric characters will be converted to underscores.
         * \@default ng_forage
         * @return {?}
         */
        function () {
            return this.config.storeName || this.baseConfig.storeName;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.storeName = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "version", {
        /**
         * The version of your database. May be used for upgrades in the future; currently unused.
         * @default 1.0
         */
        get: /**
         * The version of your database. May be used for upgrades in the future; currently unused.
         * \@default 1.0
         * @return {?}
         */
        function () {
            return 'version' in this.config ? (/** @type {?} */ (this.config.version)) : this.baseConfig.version;
        },
        set: /**
         * @param {?} v
         * @return {?}
         */
        function (v) {
            this.config.version = v;
            this.storeNeedsRecalc = true;
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "finalConfig", {
        /** @internal */
        get: /**
         * \@internal
         * @protected
         * @return {?}
         */
        function () {
            return Object.assign({}, this.baseConfig.config, this.config);
        },
        enumerable: true,
        configurable: true
    });
    Object.defineProperty(BaseConfigurableImpl.prototype, "store", {
        /** @internal */
        get: /**
         * \@internal
         * @protected
         * @return {?}
         */
        function () {
            if (this.storeNeedsRecalc || !this[store$]) {
                this[store$] = this.fact.getInstance(this.finalConfig);
                this.storeNeedsRecalc = false;
            }
            return this[store$];
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Bulk-set configuration options
     * @param opts The configuration
     */
    /**
     * Bulk-set configuration options
     * @template THIS
     * @this {THIS}
     * @param {?} opts The configuration
     * @return {THIS}
     */
    BaseConfigurableImpl.prototype.configure = /**
     * Bulk-set configuration options
     * @template THIS
     * @this {THIS}
     * @param {?} opts The configuration
     * @return {THIS}
     */
    function (opts) {
        opts = opts || {};
        if (Array.isArray(opts.driver)) {
            opts.driver = opts.driver.slice();
        }
        Object.assign((/** @type {?} */ (this)).config, opts);
        (/** @type {?} */ (this)).storeNeedsRecalc = true;
        return (/** @type {?} */ (this));
    };
    /**
     * @return {?}
     */
    BaseConfigurableImpl.prototype.toJSON = /**
     * @return {?}
     */
    function () {
        return {
            description: this.description,
            driver: this.driver,
            name: this.name,
            size: this.size,
            storeName: this.storeName,
            version: this.version
        };
    };
    /**
     * @return {?}
     */
    BaseConfigurableImpl.prototype.toString = /**
     * @return {?}
     */
    function () {
        return JSON.stringify(this.toJSON());
    };
    BaseConfigurableImpl.decorators = [
        { type: Injectable }
    ];
    /** @nocollapse */
    BaseConfigurableImpl.ctorParameters = function () { return [
        { type: NgForageConfig, decorators: [{ type: Inject, args: [NgForageConfig,] }] },
        { type: InstanceFactory, decorators: [{ type: Inject, args: [InstanceFactory,] }] }
    ]; };
    return BaseConfigurableImpl;
}());
export { BaseConfigurableImpl };
if (false) {
    /**
     * \@internal
     * @type {?}
     * @protected
     */
    BaseConfigurableImpl.prototype.baseConfig;
    /**
     * \@internal
     * @type {?}
     * @protected
     */
    BaseConfigurableImpl.prototype.config;
    /**
     * \@internal
     * @type {?}
     * @protected
     */
    BaseConfigurableImpl.prototype.fact;
    /**
     * \@internal
     * @type {?}
     * @protected
     */
    BaseConfigurableImpl.prototype.storeNeedsRecalc;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFzZS1jb25maWd1cmFibGUtaW1wbC5zZXJ2aWNlLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbmdmb3JhZ2UvIiwic291cmNlcyI6WyJsaWIvY29uZmlnL2Jhc2UtY29uZmlndXJhYmxlLWltcGwuc2VydmljZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQUFBLE9BQU8sRUFBRSxNQUFNLEVBQUUsVUFBVSxFQUFFLE1BQU0sZUFBZSxDQUFDO0FBQ25ELE9BQU8sYUFBYSxDQUFDO0FBQ3JCLE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSw4Q0FBOEMsQ0FBQztBQUc3RSxPQUFPLEVBQUMsY0FBYyxFQUFDLE1BQU0sNEJBQTRCLENBQUM7Ozs7O0lBSXBELE1BQU0sR0FBa0IsTUFBTSxDQUFDLE9BQU8sQ0FBQzs7Ozs7QUFLN0M7SUFlRSxnQkFBZ0I7SUFDaEIsOEJBQzBCLE1BQXNCLEVBQ3JCLGVBQWdDOzs7O1FBWHhDLFdBQU0sR0FBb0IsRUFBRSxDQUFDOzs7O1FBTXRDLHFCQUFnQixHQUFHLElBQUksQ0FBQztRQU9oQyxJQUFJLENBQUMsVUFBVSxHQUFHLE1BQU0sQ0FBQztRQUN6QixJQUFJLENBQUMsSUFBSSxHQUFHLGVBQWUsQ0FBQztJQUM5QixDQUFDO0lBTUQsc0JBQVcsNkNBQVc7UUFKdEI7OztXQUdHOzs7Ozs7UUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxXQUFXLElBQUksSUFBSSxDQUFDLFVBQVUsQ0FBQyxXQUFXLENBQUM7UUFDaEUsQ0FBQzs7Ozs7UUFFRCxVQUF1QixDQUFTO1lBQzlCLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBVyxHQUFHLENBQUMsQ0FBQztZQUM1QixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBQy9CLENBQUM7OztPQUxBO0lBV0Qsc0JBQVcsd0NBQU07UUFKakI7OztXQUdHOzs7Ozs7UUFDSDtZQUNFLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNLElBQUksSUFBSSxDQUFD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LE1BQU0sR0FBRyxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssRUFBRSxDQUFDO1NBQ25DO1FBRUQsTUFBTSxDQUFDLE1BQU0sQ0FBQyxtQkFBQSxJQUFJLEVBQUEsQ0FBQyxNQUFNLEVBQUUsSUFBSSxDQUFDLENBQUM7UUFDakMsbUJBQUEsSUFBSSxFQUFBLENBQUMsZ0JBQWdCLEdBQUcsSUFBSSxDQUFDO1FBRTdCLE9BQU8sbUJBQUEsSUFBSSxFQUFBLENBQUM7SUFDZCxDQUFDOzs7O0lBRU0scUNBQU07OztJQUFiO1FBQ0UsT0FBTztZQUNMLFdBQVcsRUFBRSxJQUFJLENBQUMsV0FBVztZQUM3QixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU07WUFDbkIsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJO1lBQ2YsU0FBUyxFQUFFLElBQUksQ0FBQyxTQUFTO1lBQ3pCLE9BQU8sRUFBRSxJQUFJLENBQUMsT0FBTztTQUN0QixDQUFDO0lBQ0osQ0FBQzs7OztJQUVNLHVDQUFROzs7SUFBZjtRQUNFLE9BQU8sSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsTUFBTSxFQUFFLENBQUMsQ0FBQztJQUN2QyxDQUFDOztnQkE1SkYsVUFBVTs7OztnQkFUSCxjQUFjLHVCQTBCakIsTUFBTSxTQUFDLGNBQWM7Z0JBN0JsQixlQUFlLHVCQThCbEIsTUFBTSxTQUFDLGVBQWU7O0lBMkkzQiwyQkFBQztDQUFBLEFBN0pELElBNkpDO1NBNUpxQixvQkFBb0I7Ozs7Ozs7SUFHeEMsMENBQThDOzs7Ozs7SUFHOUMsc0NBQWdEOzs7Ozs7SUFHaEQsb0NBQXlDOzs7Ozs7SUFHekMsZ0RBQWtDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgSW5qZWN0LCBJbmplY3RhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5pbXBvcnQgJ2xvY2FsZm9yYWdlJztcbmltcG9ydCB7SW5zdGFuY2VGYWN0b3J5fSBmcm9tICcuLi9pbnN0YW5jZS1mYWN0b3J5L2luc3RhbmNlLWZhY3Rvcnkuc2VydmljZSc7XG5pbXBvcnQge0RyaXZlclR5cGV9IGZyb20gJy4uL21pc2MvZHJpdmVyLXR5cGUudHlwZSc7XG5pbXBvcnQge0Jhc2VDb25maWd1cmFibGV9IGZyb20gJy4vYmFzZS1jb25maWd1cmFibGUnO1xuaW1wb3J0IHtOZ0ZvcmFnZUNvbmZpZ30gZnJvbSAnLi9uZy1mb3JhZ2UtY29uZmlnLnNlcnZpY2UnO1xuaW1wb3J0IHtOZ0ZvcmFnZU9wdGlvbnN9IGZyb20gJy4vbmctZm9yYWdlLW9wdGlvbnMnO1xuXG4vKiogQGludGVybmFsICovXG5jb25zdCBzdG9yZSQ6IHVuaXF1ZSBzeW1ib2wgPSBTeW1ib2woJ1N0b3JlJyk7XG5cbi8qKlxuICogQWJzdHJhY3Qgc2VydmljZS1sZXZlbCBjb25maWd1cmF0aW9uIGxheWVyIGZvciBOZ0ZvcmFnZVxuICovXG5ASW5qZWN0YWJsZSgpXG5leHBvcnQgYWJzdHJhY3QgY2xhc3MgQmFzZUNvbmZpZ3VyYWJsZUltcGwgaW1wbGVtZW50cyBCYXNlQ29uZmlndXJhYmxlIHtcblxuICAvKiogQGludGVybmFsICovXG4gIHByb3RlY3RlZCByZWFkb25seSBiYXNlQ29uZmlnOiBOZ0ZvcmFnZUNvbmZpZztcblxuICAvKiogQGludGVybmFsICovXG4gIHByb3RlY3RlZCByZWFkb25seSBjb25maWc6IE5nRm9yYWdlT3B0aW9ucyA9IHt9O1xuXG4gIC8qKiBAaW50ZXJuYWwgKi9cbiAgcHJvdGVjdGVkIHJlYWRvbmx5IGZhY3Q6IEluc3RhbmNlRmFjdG9yeTtcblxuICAvKiogQGludGVybmFsICovXG4gIHByb3RlY3RlZCBzdG9yZU5lZWRzUmVjYWxjID0gdHJ1ZTtcblxuICAvKiogQGludGVybmFsICovXG4gIHB1YmxpYyBjb25zdHJ1Y3RvcihcbiAgICBASW5qZWN0KE5nRm9yYWdlQ29uZmlnKSBjb25maWc6IE5nRm9yYWdlQ29uZmlnLFxuICAgIEBJbmplY3QoSW5zdGFuY2VGYWN0b3J5KSBpbnN0YW5jZUZhY3Rvcnk6IEluc3RhbmNlRmFjdG9yeVxuICApIHtcbiAgICB0aGlzLmJhc2VDb25maWcgPSBjb25maWc7XG4gICAgdGhpcy5mYWN0ID0gaW5zdGFuY2VGYWN0b3J5O1xuICB9XG5cbiAgLyoqXG4gICAqIEEgZGVzY3JpcHRpb24gb2YgdGhlIGRhdGFiYXNlLCBlc3NlbnRpYWxseSBmb3IgZGV2ZWxvcGVyIHVzYWdlLlxuICAgKiBAZGVmYXVsdCBcIlwiXG4gICAqL1xuICBwdWJsaWMgZ2V0IGRlc2NyaXB0aW9uKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLmRlc2NyaXB0aW9uIHx8IHRoaXMuYmFzZUNvbmZpZy5kZXNjcmlwdGlvbjtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgZGVzY3JpcHRpb24odjogc3RyaW5nKSB7XG4gICAgdGhpcy5jb25maWcuZGVzY3JpcHRpb24gPSB2O1xuICAgIHRoaXMuc3RvcmVOZWVkc1JlY2FsYyA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHByZWZlcnJlZCBkcml2ZXIocykgdG8gdXNlLlxuICAgKiBAZGVmYXVsdCBJbmRleGVkREIsIFdlYlNRTCBhbmQgbG9jYWxTdG9yYWdlXG4gICAqL1xuICBwdWJsaWMgZ2V0IGRyaXZlcigpOiBEcml2ZXJUeXBlIHwgRHJpdmVyVHlwZVtdIHtcbiAgICByZXR1cm4gdGhpcy5jb25maWcuZHJpdmVyIHx8IHRoaXMuYmFzZUNvbmZpZy5kcml2ZXI7XG4gIH1cblxuICBwdWJsaWMgc2V0IGRyaXZlcih2OiBEcml2ZXJUeXBlIHwgRHJpdmVyVHlwZVtdKSB7XG4gICAgdGhpcy5jb25maWcuZHJpdmVyID0gdjtcbiAgICB0aGlzLnN0b3JlTmVlZHNSZWNhbGMgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSBuYW1lIG9mIHRoZSBkYXRhYmFzZS4gTWF5IGFwcGVhciBkdXJpbmcgc3RvcmFnZSBsaW1pdCBwcm9tcHRzLiBVc2VmdWwgdG8gdXNlIHRoZSBuYW1lIG9mIHlvdXIgYXBwIGhlcmUuXG4gICAqIEluIGxvY2FsU3RvcmFnZSwgdGhpcyBpcyB1c2VkIGFzIGEga2V5IHByZWZpeCBmb3IgYWxsIGtleXMgc3RvcmVkIGluIGxvY2FsU3RvcmFnZS5cbiAgICogQGRlZmF1bHQgbmdGb3JhZ2VcbiAgICovXG4gIHB1YmxpYyBnZXQgbmFtZSgpOiBzdHJpbmcge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5uYW1lIHx8IHRoaXMuYmFzZUNvbmZpZy5uYW1lO1xuICB9XG5cbiAgcHVibGljIHNldCBuYW1lKHY6IHN0cmluZykge1xuICAgIHRoaXMuY29uZmlnLm5hbWUgPSB2O1xuICAgIHRoaXMuc3RvcmVOZWVkc1JlY2FsYyA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVGhlIHNpemUgb2YgdGhlIGRhdGFiYXNlIGluIGJ5dGVzLiBVc2VkIG9ubHkgaW4gV2ViU1FMIGZvciBub3cuXG4gICAqIEBkZWZhdWx0IDQ5ODA3MzZcbiAgICovXG4gIHB1YmxpYyBnZXQgc2l6ZSgpOiBudW1iZXIge1xuICAgIHJldHVybiB0aGlzLmNvbmZpZy5zaXplIHx8IHRoaXMuYmFzZUNvbmZpZy5zaXplO1xuICB9XG5cbiAgcHVibGljIHNldCBzaXplKHY6IG51bWJlcikge1xuICAgIHRoaXMuY29uZmlnLnNpemUgPSB2O1xuICAgIHRoaXMuc3RvcmVOZWVkc1JlY2FsYyA9IHRydWU7XG4gIH1cblxuICAvKipcbiAgICogVGhlIG5hbWUgb2YgdGhlIGRhdGFzdG9yZS5cbiAgICogSW4gSW5kZXhlZERCIHRoaXMgaXMgdGhlIGRhdGFTdG9yZSxcbiAgICogaW4gV2ViU1FMIHRoaXMgaXMgdGhlIG5hbWUgb2YgdGhlIGtleS92YWx1ZSB0YWJsZSBpbiB0aGUgZGF0YWJhc2UuXG4gICAqIE11c3QgYmUgYWxwaGFudW1lcmljLCB3aXRoIHVuZGVyc2NvcmVzLlxuICAgKiBBbnkgbm9uLWFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzIHdpbGwgYmUgY29udmVydGVkIHRvIHVuZGVyc2NvcmVzLlxuICAgKiBAZGVmYXVsdCBuZ19mb3JhZ2VcbiAgICovXG4gIHB1YmxpYyBnZXQgc3RvcmVOYW1lKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuY29uZmlnLnN0b3JlTmFtZSB8fCB0aGlzLmJhc2VDb25maWcuc3RvcmVOYW1lO1xuICB9XG5cbiAgcHVibGljIHNldCBzdG9yZU5hbWUodjogc3RyaW5nKSB7XG4gICAgdGhpcy5jb25maWcuc3RvcmVOYW1lID0gdjtcbiAgICB0aGlzLnN0b3JlTmVlZHNSZWNhbGMgPSB0cnVlO1xuICB9XG5cbiAgLyoqXG4gICAqIFRoZSB2ZXJzaW9uIG9mIHlvdXIgZGF0YWJhc2UuIE1heSBiZSB1c2VkIGZvciB1cGdyYWRlcyBpbiB0aGUgZnV0dXJlOyBjdXJyZW50bHkgdW51c2VkLlxuICAgKiBAZGVmYXVsdCAxLjBcbiAgICovXG4gIHB1YmxpYyBnZXQgdmVyc2lvbigpOiBudW1iZXIge1xuICAgIHJldHVybiAndmVyc2lvbicgaW4gdGhpcy5jb25maWcgPyA8bnVtYmVyPnRoaXMuY29uZmlnLnZlcnNpb24gOiB0aGlzLmJhc2VDb25maWcudmVyc2lvbjtcbiAgfVxuXG4gIHB1YmxpYyBzZXQgdmVyc2lvbih2OiBudW1iZXIpIHtcbiAgICB0aGlzLmNvbmZpZy52ZXJzaW9uID0gdjtcbiAgICB0aGlzLnN0b3JlTmVlZHNSZWNhbGMgPSB0cnVlO1xuICB9XG5cbiAgLyoqIEBpbnRlcm5hbCAqL1xuICBwcm90ZWN0ZWQgZ2V0IGZpbmFsQ29uZmlnKCk6IE5nRm9yYWdlT3B0aW9ucyB7XG4gICAgcmV0dXJuIE9iamVjdC5hc3NpZ24oXG4gICAgICB7fSxcbiAgICAgIHRoaXMuYmFzZUNvbmZpZy5jb25maWcsXG4gICAgICB0aGlzLmNvbmZpZ1xuICAgICk7XG4gIH1cblxuICAvKiogQGludGVybmFsICovXG4gIHByb3RlY3RlZCBnZXQgc3RvcmUoKTogTG9jYWxGb3JhZ2Uge1xuICAgIGlmICh0aGlzLnN0b3JlTmVlZHNSZWNhbGMgfHwgIXRoaXNbc3RvcmUkXSkge1xuICAgICAgdGhpc1tzdG9yZSRdID0gdGhpcy5mYWN0LmdldEluc3RhbmNlKHRoaXMuZmluYWxDb25maWcpO1xuICAgICAgdGhpcy5zdG9yZU5lZWRzUmVjYWxjID0gZmFsc2U7XG4gICAgfVxuXG4gICAgcmV0dXJuIHRoaXNbc3RvcmUkXTtcbiAgfVxuXG4gIC8qKlxuICAgKiBCdWxrLXNldCBjb25maWd1cmF0aW9uIG9wdGlvbnNcbiAgICogQHBhcmFtIG9wdHMgVGhlIGNvbmZpZ3VyYXRpb25cbiAgICovXG4gIHB1YmxpYyBjb25maWd1cmUob3B0czogTmdGb3JhZ2VPcHRpb25zKTogdGhpcyB7XG4gICAgb3B0cyA9IG9wdHMgfHwge307XG5cbiAgICBpZiAoQXJyYXkuaXNBcnJheShvcHRzLmRyaXZlcikpIHtcbiAgICAgIG9wdHMuZHJpdmVyID0gb3B0cy5kcml2ZXIuc2xpY2UoKTtcbiAgICB9XG5cbiAgICBPYmplY3QuYXNzaWduKHRoaXMuY29uZmlnLCBvcHRzKTtcbiAgICB0aGlzLnN0b3JlTmVlZHNSZWNhbGMgPSB0cnVlO1xuXG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBwdWJsaWMgdG9KU09OKCk6IFBhcnRpYWw8TmdGb3JhZ2VPcHRpb25zPiB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGRlc2NyaXB0aW9uOiB0aGlzLmRlc2NyaXB0aW9uLFxuICAgICAgZHJpdmVyOiB0aGlzLmRyaXZlcixcbiAgICAgIG5hbWU6IHRoaXMubmFtZSxcbiAgICAgIHNpemU6IHRoaXMuc2l6ZSxcbiAgICAgIHN0b3JlTmFtZTogdGhpcy5zdG9yZU5hbWUsXG4gICAgICB2ZXJzaW9uOiB0aGlzLnZlcnNpb25cbiAgICB9O1xuICB9XG5cbiAgcHVibGljIHRvU3RyaW5nKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIEpTT04uc3RyaW5naWZ5KHRoaXMudG9KU09OKCkpO1xuICB9XG59XG4iXX0=